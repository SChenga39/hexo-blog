<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/hexo-blog/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/hexo-blog/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/hexo-blog/images/favicon-16x16-next.png"><link rel="mask-icon" href="/hexo-blog/images/logo.svg" color="#222"><link rel="stylesheet" href="/hexo-blog/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script><script class="next-config" data-name="main" type="application/json">{"hostname":"schenga39.github.io","root":"/hexo-blog/","images":"/hexo-blog/images","scheme":"Gemini","darkmode":false,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"base16/one-light","dark":"base16/onedark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":"default"},"fold":{"enable":true,"height":500},"language":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/hexo-blog/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/hexo-blog/js/config.js" defer></script><meta property="og:type" content="website"><meta property="og:title" content="SChenga&#39;s blog"><meta property="og:url" content="https://schenga39.github.io/hexo-blog/index.html"><meta property="og:site_name" content="SChenga&#39;s blog"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="SChenga"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://schenga39.github.io/hexo-blog/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>SChenga's blog</title><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script><script src="/hexo-blog/js/utils.js" defer></script><script src="/hexo-blog/js/sidebar.js" defer></script><script src="/hexo-blog/js/next-boot.js" defer></script><script src="/hexo-blog/js/pjax.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script><script src="/hexo-blog/js/third-party/search/local-search.js" defer></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.7.0/mermaid.min.js","integrity":"sha256-4+IKDqhZ/sXjc8Wtl2/MsxI4e0s1KpEVdbEP7V/Lz8U="}}</script><script src="/hexo-blog/js/third-party/tags/mermaid.js" defer></script><script src="/hexo-blog/js/third-party/pace.js" defer></script><noscript><link rel="stylesheet" href="/hexo-blog/css/noscript.css"></noscript><link rel="alternate" href="/hexo-blog/atom.xml" title="SChenga's blog" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/hexo-blog/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">SChenga's blog</h1><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/hexo-blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/hexo-blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">6</span></a></li><li class="menu-item menu-item-archives"><a href="/hexo-blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">13</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">SChenga</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/hexo-blog/archives/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">6</span> <span class="site-state-item-name">标签</span></div></nav></div></div></div></div></aside></div><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/10/07/Linux-Wine-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/10/07/Linux-Wine-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Linux Wine 使用指南</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-10-08 00:00:00" itemprop="dateCreated datePublished" datetime="2023-10-08T00:00:00+08:00">2023-10-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="Wine-是什么"><a href="#Wine-是什么" class="headerlink" title="Wine 是什么"></a>Wine 是什么</h2><blockquote><p>Wine is a compatibility layer capable of running Microsoft Windows applications on Unix-like operating systems. Programs running in Wine act as native programs would, without the performance&#x2F;memory penalties of an emulator.</p></blockquote><p>简单来说，Wine 可以让你在 Linux 系统上无缝运行 Windows 下的应用程序，而且相比于虚拟机可以获得更好的性能。</p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>首先确保你使用的是 X11 桌面，已知 Wayland 桌面环境有兼容性问题。</p><p>输入以下命令安装 Wine 以及相关组件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S wine wine-mono wine_gecko wine-staging giflib lib32-giflib libpng lib32-libpng libldap lib32-libldap gnutls lib32-gnutls \</span><br><span class="line">    mpg123 lib32-mpg123 openal lib32-openal v4l-utils lib32-v4l-utils libpulse lib32-libpulse libgpg-error \</span><br><span class="line">    lib32-libgpg-error alsa-plugins lib32-alsa-plugins alsa-lib lib32-alsa-lib libjpeg-turbo lib32-libjpeg-turbo \</span><br><span class="line">    sqlite lib32-sqlite libxcomposite lib32-libxcomposite libxinerama lib32-libgcrypt libgcrypt lib32-libxinerama \</span><br><span class="line">    ncurses lib32-ncurses opencl-icd-loader lib32-opencl-icd-loader libxslt lib32-libxslt libva lib32-libva gtk3 \</span><br><span class="line">    lib32-gtk3 gst-plugins-base-libs lib32-gst-plugins-base-libs vulkan-icd-loader lib32-vulkan-icd-loader</span><br></pre></td></tr></table></figure><p>一般来说，安装完 Wine 之后直接双击 exe 程序即可运行。但是有些应用可能在 64 位 Wine 下无法运行，此时就需要手动切换到 32 位 Wine 环境：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置架构为 win32，配置文件保存在 `~/.win32` 目录下</span></span><br><span class="line"><span class="comment"># 打开 Wine 配置界面</span></span><br><span class="line">WINEARCH=win32 WINEPREFIX=~/.win32 winecfg</span><br><span class="line"><span class="comment"># 运行程序</span></span><br><span class="line">WINEARCH=win32 WINEPREFIX=~/.win32 wine /path/to/program.exe</span><br></pre></td></tr></table></figure><p>如果你需要运行 GalGame，则可能需要执行以下命令安装额外组件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S winetricks d3dx9 quartz devenum wmp10 gdiplus dotnet40 ffdshow cjkfonts</span><br></pre></td></tr></table></figure><h2 id="Wine-前缀管理"><a href="#Wine-前缀管理" class="headerlink" title="Wine 前缀管理"></a>Wine 前缀管理</h2><p>一般来说，可以为每个软件新建一个 Wine 环境，使用单独的配置运行每个 exe 程序，这时候就需要进行前缀管理。</p><p>我在 <code>~/.zshrc</code> 文件中配置了默认使用的 Wine 前缀和架构如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> WINEARCH=win32</span><br><span class="line"><span class="built_in">export</span> WINEPREFIX=~/.win32</span><br></pre></td></tr></table></figure><p>这样就不用每次执行 exe 时都要在前面加上 WINEARCH 参数了。</p><p>此外，还可以为每个 exe 文件编写运行脚本，一键运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">WINEARCH=win32</span><br><span class="line">WINEPREFIX=~/.win32</span><br><span class="line">wine /home/username/.win32/drive_c/altera/13.0sp1/quartus/bin/quartus.exe</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Wine">Wine - ArchWiki</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/09/27/Arch-Linux-%E5%AE%89%E8%A3%85%E5%85%A8%E8%BF%87%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/09/27/Arch-Linux-%E5%AE%89%E8%A3%85%E5%85%A8%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">Arch Linux 安装全过程</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-09-28 00:00:00" itemprop="dateCreated datePublished" datetime="2023-09-28T00:00:00+08:00">2023-09-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="为什么离开-Windows"><a href="#为什么离开-Windows" class="headerlink" title="为什么离开 Windows"></a>为什么离开 Windows</h2><ol><li>微软的监控</li><li>盗版的风险</li></ol><h2 id="安装完整步骤"><a href="#安装完整步骤" class="headerlink" title="安装完整步骤"></a>安装完整步骤</h2><ol><li><p>下载 Arch Linux iso 镜像文件</p><ul><li>使用 <a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/archlinux/iso/2023.09.01/archlinux-2023.09.01-x86_64.iso">中科大镜像</a></li></ul></li><li><p>下载 Rufus 刻录软件</p></li><li><p>写入镜像到 U 盘</p></li><li><p>开机狂按 Del 键进入 BIOS，关闭安全启动</p></li><li><p>开机狂按 F11 进入引导项，选择 U 盘</p></li><li><p>在启动选择界面选择第一项：<code>Arch Linux install medium (x86_64, UEFI)</code></p></li><li><p>依次执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用 reflector 服务</span></span><br><span class="line">systemctl stop reflector.service</span><br><span class="line"><span class="comment"># 检查 reflector 服务是否被关闭</span></span><br><span class="line">systemctl status reflector.service</span><br><span class="line"><span class="comment"># 确认当前是否运行在 UEFI 模式</span></span><br><span class="line"><span class="comment"># 如果出现一堆东西已在 UEFI 模式，否则需要确认启动方式是否为 UEFI</span></span><br><span class="line"><span class="built_in">ls</span> /sys/firmware/efi/efivars</span><br><span class="line"><span class="comment"># 连接网络: 使用无线连接才需要进行以下步骤</span></span><br><span class="line">iwctl <span class="comment"># 进入交互式命令行</span></span><br><span class="line">device list <span class="comment"># 列出无线网卡设备名，比如无线网卡看到叫 wlan0</span></span><br><span class="line">station wlan0 scan <span class="comment"># 扫描网络</span></span><br><span class="line">station wlan0 get-networks <span class="comment"># 列出所有 wifi 网络</span></span><br><span class="line">station wlan0 connect wifi-name <span class="comment"># 进行连接，注意这里无法输入中文。回车后输入密码即可</span></span><br><span class="line"><span class="built_in">exit</span> <span class="comment"># 连接成功后退出</span></span><br><span class="line"><span class="comment"># 测试网络连通性</span></span><br><span class="line">ping www.bilibili.com</span><br><span class="line"><span class="comment"># 更新系统时钟</span></span><br><span class="line"><span class="comment"># 这步很重要，关系到后面 pgp 密钥环更新环节</span></span><br><span class="line">timedatectl set-ntp <span class="literal">true</span> <span class="comment"># 将系统时间与网络时间进行同步</span></span><br><span class="line">timedatectl status <span class="comment"># 检查服务状态</span></span><br><span class="line"><span class="comment"># 修改镜像源为国内，加快下载速度</span></span><br><span class="line"><span class="comment"># 推荐使用中科大源和清华源</span></span><br><span class="line">vim /etc/pacman.d/mirrorlist</span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinux/<span class="variable">$repo</span>/os/<span class="variable">$arch</span> <span class="comment"># 中国科学技术大学开源镜像站</span></span><br><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/<span class="variable">$repo</span>/os/<span class="variable">$arch</span> <span class="comment"># 清华大学开源软件镜像站</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 分区和格式化</span></span><br><span class="line">lsblk <span class="comment"># 显示当前分区情况</span></span><br><span class="line"><span class="comment"># 使用 cfdisk 对磁盘分区</span></span><br><span class="line">cfdisk /dev/nvme0n1</span><br><span class="line"><span class="comment"># 如果不再使用 Windows，则抹掉硬盘上原来的文件系统</span></span><br><span class="line">wipefs --all /dev/nvme0n1</span><br><span class="line"><span class="comment"># 创建三个分区: EFI、Swap 和主分区</span></span><br><span class="line"><span class="comment"># EFI: 512M, Swap: 14G, 剩下的给主分区</span></span><br><span class="line"><span class="comment"># 分区完成后查看磁盘情况</span></span><br><span class="line">lsblk</span><br><span class="line"><span class="comment"># 下面假设</span></span><br><span class="line"><span class="comment"># EFI: /dev/nvme0n1p1</span></span><br><span class="line"><span class="comment"># Swap: /dev/nvme0n1p2</span></span><br><span class="line"><span class="comment"># 主分区: /dev/nvme0n1p3</span></span><br><span class="line"><span class="comment"># 格式化 Swap 分区</span></span><br><span class="line">mkswap /dev/nvme0n1p2</span><br><span class="line"><span class="comment"># 使用 Btrfs 格式化主分区</span></span><br><span class="line">mkfs.btrfs -L myArch /dev/nvme0n1p3</span><br><span class="line"><span class="comment"># 将主分区挂载以创建子卷</span></span><br><span class="line">mount -t btrfs -o compress=zstd /dev/nvme0n1p3 /mnt</span><br><span class="line"><span class="comment"># 查看挂载情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="comment"># 创建 / 目录子卷</span></span><br><span class="line">btrfs subvolume create /mnt/@</span><br><span class="line"><span class="comment"># 创建 /home 目录子卷</span></span><br><span class="line">btrfs subvolume create /mnt/@home</span><br><span class="line"><span class="comment"># 查看子卷情况</span></span><br><span class="line">btrfs subvolume list -p /mnt</span><br><span class="line"><span class="comment"># 卸载主分区以挂载子卷</span></span><br><span class="line">umount /mnt</span><br><span class="line"><span class="comment"># 挂载子卷 (请务必依次执行下列命令)</span></span><br><span class="line">mount -t btrfs -o subvol=/@,compress=zstd /dev/nvme0n1p3 /mnt <span class="comment"># 挂载 / 目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /mnt/home <span class="comment"># 创建 /home 目录</span></span><br><span class="line">mount -t btrfs -o subvol=/@home,compress=zstd /dev/nvme0n1p3 /mnt/home <span class="comment"># 挂载 /home 目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt/boot/efi <span class="comment"># 创建 /boot/efi 目录</span></span><br><span class="line">mount /dev/nvme0n1p1 /mnt/boot/efi <span class="comment"># 挂载 /boot/efi 目录</span></span><br><span class="line">swapon /dev/nvme0n1p2 <span class="comment"># 挂载交换分区</span></span><br><span class="line"><span class="comment"># 查看挂载情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="comment"># 查看 Swap 分区挂载情况</span></span><br><span class="line">free -h</span><br><span class="line"><span class="comment"># 安装系统</span></span><br><span class="line">pacstrap /mnt base base-devel linux linux-firmware btrfs-progs</span><br><span class="line"><span class="comment"># 安装其他必要的功能性软件</span></span><br><span class="line">pacstrap /mnt dhcpcd networkmanager vim sudo zsh zsh-completions</span><br><span class="line"><span class="comment"># 生成 fstab 文件</span></span><br><span class="line">genfstab -U /mnt &gt; /mnt/etc/fstab</span><br><span class="line"><span class="comment"># 查看 /mnt/etc/fstab 确保没有错误</span></span><br><span class="line"><span class="built_in">cat</span> /mnt/etc/fstab</span><br><span class="line"><span class="comment"># 将系统环境切换到新系统下</span></span><br><span class="line">arch-chroot /mnt</span><br><span class="line"><span class="comment"># 设置主机名与分区</span></span><br><span class="line">vim /etc/hostname</span><br><span class="line"><span class="comment"># 设置 hosts</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line">127.0.0.1   localhost</span><br><span class="line">::1         localhost</span><br><span class="line">127.0.1.1   myarch.localdomain  myarch</span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line"><span class="built_in">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"><span class="comment"># 将系统时间同步到硬件</span></span><br><span class="line">hwclock --systohc</span><br><span class="line"><span class="comment"># 设置 Locale</span></span><br><span class="line">vim /etc/locale.gen</span><br><span class="line"><span class="comment"># 去掉 `en_US.UTF-8 UTF-8` 以及 `zh_CN.UTF-8 UTF-8` 行前的注释符号</span></span><br><span class="line"><span class="comment"># 生成 locale</span></span><br><span class="line">locale-gen</span><br><span class="line"><span class="comment"># 向 /etc/locale.conf 添加内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;LANG=en_US.UTF-8&#x27;</span>  &gt; /etc/locale.conf</span><br><span class="line"><span class="comment"># 为 root 用户设置密码</span></span><br><span class="line">passwd root</span><br><span class="line"><span class="comment"># 安装芯片制造商的微码</span></span><br><span class="line">pacman -S intel-ucode <span class="comment"># Intel</span></span><br><span class="line">pacman -S amd-ucode <span class="comment"># AMD</span></span><br><span class="line"><span class="comment"># 安装引导程序</span></span><br><span class="line">pacman -S grub efibootmgr os-prober</span><br><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ARCH</span><br><span class="line"><span class="comment"># 编辑 GRUB 文件</span></span><br><span class="line">vim /etc/default/grub</span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 去掉 GRUB_CMDLINE_LINUX_DEFAULT 一行中最后的 quiet 参数</span></span><br><span class="line"><span class="comment"># 把 loglevel 的数值从 3 改成 5，为了后续出现系统错误时方便排错</span></span><br><span class="line"><span class="comment"># 加入 nowatchdog 参数，显著提高开关机速度</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;loglevel=5 nowatchdog&quot;</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 如果需要引导 Windows 10 则需要再加一行</span></span><br><span class="line">GRUB_DISABLE_OS_PROBER=<span class="literal">false</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 生成 GRUB 所需的配置文件</span></span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"><span class="comment"># 完成安装, 这个时候拔掉 U 盘</span></span><br><span class="line"><span class="built_in">exit</span> <span class="comment"># 退回安装环境</span></span><br><span class="line">umount -R /mnt <span class="comment"># 卸载新分区</span></span><br><span class="line">reboot <span class="comment"># 重启</span></span><br></pre></td></tr></table></figure></li><li><p>重启后使用 root 和密码登录 Linux 并执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> --now NetworkManager <span class="comment"># 设置开机自启并立即启动 NetworkManager 服务</span></span><br><span class="line">ping www.bilibili.com <span class="comment"># 测试网络连接</span></span><br><span class="line"><span class="comment"># 若使用无线连接则先连接网络</span></span><br><span class="line">nmcli dev wifi list <span class="comment"># 显示附近的 Wi-Fi 网络</span></span><br><span class="line">nmcli dev wifi connect <span class="string">&quot;Wi-Fi名（SSID）&quot;</span> password <span class="string">&quot;网络密码&quot;</span> <span class="comment"># 连接指定的无线网络</span></span><br><span class="line"><span class="comment"># 安装 neofetch</span></span><br><span class="line">pacman -S neofetch</span><br><span class="line"><span class="comment"># 使用 neofetch 打印系统信息</span></span><br><span class="line">neofetch</span><br><span class="line"><span class="comment"># 关机</span></span><br><span class="line">shutdown -h now</span><br></pre></td></tr></table></figure></li><li><p>至此，无图形界面的 archlinux 已安装完成</p></li></ol><h2 id="图形界面安装和配置"><a href="#图形界面安装和配置" class="headerlink" title="图形界面安装和配置"></a>图形界面安装和配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保当前系统为最新</span></span><br><span class="line">pacman -Syyu</span><br><span class="line"><span class="comment"># 配置 root 账户默认编辑器</span></span><br><span class="line">vim ~/.bash_profile</span><br><span class="line"><span class="comment"># 添加以下内容</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="built_in">export</span> EDITOR=<span class="string">&#x27;vim&#x27;</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 准备非 Root 用户</span></span><br><span class="line">useradd -m -G wheel -s /bin/bash myusername</span><br><span class="line"><span class="comment"># 设置新用户的密码</span></span><br><span class="line">passwd myusername</span><br><span class="line"><span class="comment"># 同意新用户使用 sudo</span></span><br><span class="line">vim /etc/sudoers</span><br><span class="line"><span class="comment"># 找到下面一行并把前面的 `#` 去掉</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment">#%wheel ALL=(ALL) ALL</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 开启 32位支持库和Arch Linux 中文社区仓库</span></span><br><span class="line">vim /etc/pacman.conf</span><br><span class="line"><span class="comment"># 去掉 `[multilib]` 一节中的两行注释</span></span><br><span class="line"><span class="comment"># 在末尾添加如下内容</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line">[archlinuxcn]</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/<span class="variable">$arch</span> <span class="comment"># 中国科学技术大学开源镜像站</span></span><br><span class="line">Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/<span class="variable">$arch</span> <span class="comment"># 清华大学开源软件镜像站</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 再次更新系统</span></span><br><span class="line">pacman -Syyu</span><br><span class="line"><span class="comment"># 安装 KDE Plasma 桌面环境</span></span><br><span class="line">pacman -S plasma-meta konsole dolphin</span><br><span class="line"><span class="comment"># (可选) 安装 wayland</span></span><br><span class="line">pacman -S  plasma-wayland-session xdg-desktop-portal</span><br><span class="line"><span class="comment"># 配置并启动欢迎屏幕</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now sddm</span><br><span class="line"><span class="comment"># 输入新用户密码即可登录桌面</span></span><br></pre></td></tr></table></figure><h2 id="图形界面的后续配置"><a href="#图形界面的后续配置" class="headerlink" title="图形界面的后续配置"></a>图形界面的后续配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试桌面环境网络连通性</span></span><br><span class="line">ping www.bilibili.com</span><br><span class="line"><span class="comment"># 安装基础功能包</span></span><br><span class="line">sudo pacman -S ntfs-3g <span class="comment"># 使系统可以识别 NTFS 格式的硬盘</span></span><br><span class="line">sudo pacman -S adobe-source-han-serif-cn-fonts wqy-zenhei <span class="comment"># 安装几个开源中文字体。一般装上文泉驿就能解决大多 wine 应用中文方块的问题</span></span><br><span class="line">sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra <span class="comment"># 安装谷歌开源字体及表情</span></span><br><span class="line">sudo pacman -S firefox chromium <span class="comment"># 安装常用的火狐、chromium 浏览器</span></span><br><span class="line">sudo pacman -S ark <span class="comment"># 压缩软件。在 dolphin 中可用右键解压压缩包</span></span><br><span class="line">sudo pacman -S packagekit-qt5 packagekit appstream-qt appstream <span class="comment"># 确保 Discover（软件中心）可用，需重启</span></span><br><span class="line">sudo pacman -S gwenview <span class="comment"># 图片查看器</span></span><br><span class="line">sudo pacman -S steam <span class="comment"># 游戏商店。稍后看完显卡驱动章节再使用</span></span><br><span class="line">sudo pacman -S archlinuxcn-keyring <span class="comment"># cn 源中的签名（archlinuxcn-keyring 在 archlinuxcn）</span></span><br><span class="line">sudo pacman -S yay <span class="comment"># yay 命令可以让用户安装 AUR 中的软件（yay 在 archlinuxcn）</span></span><br><span class="line"><span class="comment"># 检查家目录下常见目录是否创建, 若未创建则需要手动创建</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">ls</span> -hl</span><br><span class="line"><span class="built_in">mkdir</span> Desktop Documents Downloads Music Pictures Videos</span><br></pre></td></tr></table></figure><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="出现-PGP-signature-Error"><a href="#出现-PGP-signature-Error" class="headerlink" title="出现 PGP signature Error"></a>出现 PGP signature Error</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman-key --init</span><br><span class="line">pacman-key --populate</span><br><span class="line">pacman -S archlinux-keyring</span><br></pre></td></tr></table></figure><h3 id="显卡驱动问题"><a href="#显卡驱动问题" class="headerlink" title="显卡驱动问题"></a>显卡驱动问题</h3><p>NVIDIA 驱动未正常运行，具体现象为按步骤完成安装并进入桌面后打开应用很慢，且在终端执行 <code>nvtop</code> 显示无法找到显卡</p><p>经过排查后发现是由于 Linux 系统自带的 nouveau 比 NVIDIA 官方驱动更早启动，导致 NVIDIA 驱动无法正常运行。</p><p>解决方法如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看启动时系统内核输出消息</span></span><br><span class="line">sudo dmesg</span><br><span class="line"><span class="comment"># 禁用 Linux 自带的 nouveau 显卡驱动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;blacklist nouveau&#x27;</span> &gt; /etc/modprobe.d/blacklist-nvidia-nouveau.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;options nouveau modeset=0&#x27;</span> &gt;&gt; /etc/modprobe.d/blacklist-nvidia-nouveau.conf</span><br><span class="line"><span class="comment"># 重新制作镜像</span></span><br><span class="line">sudo mkinitcpio -p linux</span><br></pre></td></tr></table></figure><h3 id="蓝牙耳机无法连接"><a href="#蓝牙耳机无法连接" class="headerlink" title="蓝牙耳机无法连接"></a>蓝牙耳机无法连接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S pulseaudio</span><br><span class="line">sudo pacman -S pulseaudio-bluetooth</span><br></pre></td></tr></table></figure><h3 id="Dolphin-预览-avif-格式的图片-2"><a href="#Dolphin-预览-avif-格式的图片-2" class="headerlink" title="Dolphin 预览 avif 格式的图片 2"></a>Dolphin 预览 avif 格式的图片 2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S kimageformats</span><br><span class="line">sudo pacman -S shared-mime-info</span><br><span class="line">sudo pacman -S libavif</span><br></pre></td></tr></table></figure><h3 id="crontab-报错：-usr-bin-vi-exited-with-status-127"><a href="#crontab-报错：-usr-bin-vi-exited-with-status-127" class="headerlink" title="crontab 报错：&quot;/usr/bin/vi&quot; exited with status 127"></a>crontab 报错：<code>&quot;/usr/bin/vi&quot; exited with status 127</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~/.profile</span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line">EDITOR=<span class="string">&#x27;/bin/vim&#x27;</span></span><br><span class="line">VISUAL=<span class="string">&#x27;/bin/vim&#x27;</span></span><br><span class="line"><span class="built_in">export</span> EDITOR VISUAL</span><br><span class="line"><span class="comment"># ========================================</span></span><br></pre></td></tr></table></figure><h3 id="Gwenview-无法显示-webp-图像"><a href="#Gwenview-无法显示-webp-图像" class="headerlink" title="Gwenview 无法显示 webp 图像"></a>Gwenview 无法显示 webp 图像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S qt5-imageformats</span><br></pre></td></tr></table></figure><h2 id="编程环境配置"><a href="#编程环境配置" class="headerlink" title="编程环境配置"></a>编程环境配置</h2><h3 id="OpenCV（C-和-Python）"><a href="#OpenCV（C-和-Python）" class="headerlink" title="OpenCV（C++ 和 Python）"></a>OpenCV（C++ 和 Python）</h3><ol><li><p>安装依赖包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S opencv hdf5 tk</span><br><span class="line">pip install opencv-python</span><br></pre></td></tr></table></figure></li><li><p>编辑项目的 CMake 文件，添加如下两行（仅 C++ 需要）</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span> (OpenCV <span class="number">4.0</span>.<span class="number">0</span> REQUIRED)</span><br><span class="line"><span class="keyword">include_directories</span> (<span class="string">&quot;/usr/include/opencv4/&quot;</span>)</span><br></pre></td></tr></table></figure></li></ol><h3 id="C-Boost-库"><a href="#C-Boost-库" class="headerlink" title="C++ Boost 库"></a>C++ Boost 库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Ss boost</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a target="_blank" rel="noopener" href="https://arch-linux.osrc.com/">archlinux 简明指南</a></li><li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/NVIDIA">NVIDIA - ArchWiki</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/06/11/Linux-sysctl-%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/06/11/Linux-sysctl-%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">Linux sysctl 调优实战</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-06-12 00:00:00" itemprop="dateCreated datePublished" datetime="2023-06-12T00:00:00+08:00">2023-06-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="sysctl-的使用方式"><a href="#sysctl-的使用方式" class="headerlink" title="sysctl 的使用方式"></a>sysctl 的使用方式</h2><ol><li>使用命令 <code>sysctl -w key=value</code> 手动调整选项值</li><li>使用命令 <code>sysctl key</code> 获取选项当前的值</li><li>（推荐）先编辑文件 <code>/etc/sysctl.conf</code> 然后使用命令 <code>sysctl -p</code> 一键导入已修改的键值对</li></ol><h2 id="使用合适的拥塞控制算法"><a href="#使用合适的拥塞控制算法" class="headerlink" title="使用合适的拥塞控制算法"></a>使用合适的拥塞控制算法</h2><p>拥塞控制是通过算法来提升或降低数据发送速率以防止网络出现拥堵。常见的拥塞控制算法有 reno、cubic、bbr 等，其中 reno 和 cubic 是基于丢失的算法（出现拥堵后降低发送速率），bbr 则是基于模型（监控延迟是否改变）。</p><p>在 Linux 中可以使用 <code>sysctl net.ipv4.tcp_congestion_control</code> 查看当前系统使用的拥塞控制算法。使用 <code>uname -r</code> 查看 Linux 内核版本，若版本低于 4.9 则未内置 bbr 算法，可以先更新内核版本。</p><h2 id="优化完成后的-sysctl-conf-文件"><a href="#优化完成后的-sysctl-conf-文件" class="headerlink" title="优化完成后的 sysctl.conf 文件"></a>优化完成后的 sysctl.conf 文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件系统优化</span></span><br><span class="line">fs.aio-max-nr=1048576</span><br><span class="line">fs.file-max=1000000</span><br><span class="line">fs.inotify.max_user_instances=4096</span><br><span class="line">fs.lease-break-time=30</span><br><span class="line"><span class="comment"># 开启崩溃自动重启</span></span><br><span class="line">kernel.panic=1</span><br><span class="line">kernel.sysrq=0</span><br><span class="line">kernel.pid_max=1000000</span><br><span class="line">net.core.default_qdisc=fq</span><br><span class="line">net.core.netdev_max_backlog=65536</span><br><span class="line">net.core.rmem_default=3400000</span><br><span class="line">net.core.rmem_max=67000000</span><br><span class="line">net.core.somaxconn=65535</span><br><span class="line">net.core.wmem_default=3400000</span><br><span class="line">net.core.wmem_max=67000000</span><br><span class="line">net.core.optmem_max=67000000</span><br><span class="line"><span class="comment"># 关闭 ICMP 重定向请求</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects=0</span><br><span class="line">net.ipv4.conf.default.rp_filter=1</span><br><span class="line">net.ipv4.conf.default.accept_redirects=0</span><br><span class="line">net.ipv4.conf.default.secure_redirects=0</span><br><span class="line"><span class="comment"># 路由系统中不要禁用</span></span><br><span class="line">net.ipv4.conf.default.send_redirects=0</span><br><span class="line"><span class="comment"># 禁 ping</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_all=1</span><br><span class="line">net.ipv6.icmp.echo_ignore_all=1</span><br><span class="line"><span class="comment"># 关闭攻击记录日志</span></span><br><span class="line">net.ipv4.conf.default.log_martians=0</span><br><span class="line"><span class="comment"># 禁用 IP 源路由</span></span><br><span class="line">net.ipv4.conf.default.accept_source_route=0</span><br><span class="line"><span class="comment"># 避免放大攻击</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts=1</span><br><span class="line"><span class="comment"># 启用恶意错误信息防护</span></span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses=1</span><br><span class="line"><span class="comment"># 关闭 IPv4 包转发</span></span><br><span class="line">net.ipv4.ip_forward=0</span><br><span class="line"><span class="comment"># 增大本地端口范围</span></span><br><span class="line">net.ipv4.ip_local_port_range=1024 65000</span><br><span class="line"><span class="comment"># 开启 MTU 嗅探</span></span><br><span class="line">net.ipv4.ip_no_pmtu_disc=0</span><br><span class="line"><span class="comment"># 加快路由缓存刷新频率</span></span><br><span class="line">net.ipv4.route.gc_timeout=100</span><br><span class="line">net.ipv4.tcp_adv_win_scale=1</span><br><span class="line">net.ipv4.tcp_base_mss=1024</span><br><span class="line">net.ipv4.tcp_comp_sack_delay_ns=1000000</span><br><span class="line"><span class="comment"># 调整拥塞控制算法为 BBR</span></span><br><span class="line">net.ipv4.tcp_congestion_control=bbr</span><br><span class="line"><span class="comment"># 关闭 early demux</span></span><br><span class="line">net.ipv4.tcp_early_demux=0</span><br><span class="line">net.ipv4.tcp_ecn=1</span><br><span class="line">net.ipv4.tcp_ecn_fallback=1</span><br><span class="line"><span class="comment"># 开启发送和接收双向的 fastopen</span></span><br><span class="line">net.ipv4.tcp_fastopen=3</span><br><span class="line"><span class="comment"># 缩短处于 FIN_WAIT_2 状态的时间</span></span><br><span class="line">net.ipv4.tcp_fin_timeout=30</span><br><span class="line">net.ipv4.tcp_frto=2</span><br><span class="line"><span class="comment"># TCP 发送心跳包的时间间隔</span></span><br><span class="line">net.ipv4.tcp_keepalive_time=1200</span><br><span class="line">net.ipv4.tcp_keepalive_intvl=30</span><br><span class="line">net.ipv4.tcp_keepalive_probes=3</span><br><span class="line"><span class="comment"># 已记住的连接数</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog=2048</span><br><span class="line"><span class="comment"># 增大 tw buckets</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets=2000000</span><br><span class="line">net.ipv4.tcp_min_rtt_wlen=50</span><br><span class="line">net.ipv4.tcp_min_tso_segs=2</span><br><span class="line"><span class="comment"># TCP 包大小自适应</span></span><br><span class="line">net.ipv4.tcp_moderate_rcvbuf=1</span><br><span class="line"><span class="comment"># 打开 TCP MTU 嗅探</span></span><br><span class="line">net.ipv4.tcp_mtu_probing=1</span><br><span class="line">net.ipv4.tcp_no_metrics_save=1</span><br><span class="line"><span class="comment"># 开启 tcp_notsent_lowat</span></span><br><span class="line">net.ipv4.tcp_notsent_lowat=131072</span><br><span class="line">net.ipv4.tcp_orphan_retries=2</span><br><span class="line">net.ipv4.tcp_recovery=1</span><br><span class="line">net.ipv4.tcp_reordering=6</span><br><span class="line"><span class="comment"># 放弃回应一个 TCP 连接请求前需进行多少次重试</span></span><br><span class="line">net.ipv4.tcp_retries1=3</span><br><span class="line"><span class="comment"># 在丢弃已建立通讯状况的 TCP 连接前需进行多少次重试</span></span><br><span class="line">net.ipv4.tcp_retries2=3</span><br><span class="line"><span class="comment"># 开启 RFC1337 标准</span></span><br><span class="line">net.ipv4.tcp_rfc1337=1</span><br><span class="line"><span class="comment"># 启用有选择的应答</span></span><br><span class="line">net.ipv4.tcp_sack=1</span><br><span class="line">net.ipv4.tcp_fack=1</span><br><span class="line">net.ipv4.tcp_tw_reuse=1</span><br><span class="line">net.ipv4.tcp_max_orphans=3276800</span><br><span class="line"><span class="comment"># 加快重发</span></span><br><span class="line">net.ipv4.tcp_slow_start_after_idle=0</span><br><span class="line">net.ipv4.tcp_early_retrans=1</span><br><span class="line">net.ipv4.tcp_syn_retries=3</span><br><span class="line">net.ipv4.tcp_synack_retries=2</span><br><span class="line"><span class="comment"># SYN 等待队列溢出时启用 cookies 处理, 防止 SYN 攻击</span></span><br><span class="line">net.ipv4.tcp_syncookies=1</span><br><span class="line"><span class="comment"># 开启 TCP 时间戳, 防止 TCP 的 RST 攻击</span></span><br><span class="line">net.ipv4.tcp_timestamps=1</span><br><span class="line">net.ipv4.tcp_tso_win_divisor=2</span><br><span class="line"><span class="comment"># 要支持超过 64KB 的窗口大小需要启用</span></span><br><span class="line">net.ipv4.tcp_window_scaling=1</span><br><span class="line"><span class="comment"># tcp 内存调整</span></span><br><span class="line">net.ipv4.tcp_mem=78643200 104857600 157286400</span><br><span class="line">net.ipv4.tcp_wmem=4096 66560 70254592</span><br><span class="line">net.ipv4.tcp_rmem=4096 89088 70254592</span><br><span class="line"><span class="comment"># 关闭 early demux</span></span><br><span class="line">net.ipv4.udp_early_demux=0</span><br><span class="line"><span class="comment"># 增大 UDP 内存限制</span></span><br><span class="line">net.ipv4.udp_mem=78643200 104857600 157286400</span><br><span class="line"><span class="comment"># net.ipv4.udp_rmem_min=94500000</span></span><br><span class="line"><span class="comment"># net.ipv4.udp_wmem_min=94500000</span></span><br><span class="line"><span class="comment"># 不使用 IPv6 时彻底关闭 IPv6</span></span><br><span class="line">net.ipv6.conf.default.disable_ipv6=1</span><br><span class="line"><span class="comment"># 使用 IPv6 时优化</span></span><br><span class="line"><span class="comment"># net.ipv6.conf.all.forwarding=1</span></span><br><span class="line"><span class="comment"># net.ipv6.conf.all.accept_ra=2</span></span><br><span class="line"><span class="comment"># net.ipv6.conf.all.proxy_ndp=1</span></span><br><span class="line"><span class="comment"># net.ipv6.conf.all.hop_limit=128</span></span><br><span class="line"><span class="comment"># net.ipv6.conf.default.hop_limit=128</span></span><br><span class="line"><span class="comment"># net.ipv6.route.min_adv_mss=1024</span></span><br><span class="line"><span class="comment"># net.ipv6.route.mtu_expires=600</span></span><br><span class="line"><span class="comment"># 调整内存写回策略</span></span><br><span class="line">vm.dirty_background_ratio=2</span><br><span class="line">vm.dirty_expire_centisecs=600</span><br><span class="line">vm.dirty_ratio=5</span><br><span class="line">vm.dirty_writeback_centisecs=100</span><br><span class="line">vm.max_map_count=262144</span><br><span class="line">vm.min_free_kbytes=262144</span><br><span class="line">vm.swappiness=10</span><br><span class="line">vm.vfs_cache_pressure=200</span><br><span class="line"><span class="comment"># netfilter 调整</span></span><br><span class="line">net.netfilter.nf_conntrack_acct=1</span><br><span class="line">net.netfilter.nf_conntrack_checksum=0</span><br><span class="line">net.netfilter.nf_conntrack_max=65535</span><br><span class="line">net.netfilter.nf_conntrack_tcp_timeout_established=7440</span><br><span class="line">net.netfilter.nf_conntrack_udp_timeout=60</span><br><span class="line">net.netfilter.nf_conntrack_udp_timeout_stream=180</span><br></pre></td></tr></table></figure><h2 id="调整-Linux-系统限制"><a href="#调整-Linux-系统限制" class="headerlink" title="调整 Linux 系统限制"></a>调整 Linux 系统限制</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改系统安全限制</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* soft nofile 51200&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;* hard nofile 51200&quot;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;session required pam_limits.so&quot;</span> &gt;&gt; /etc/pam.d/common-session</span><br><span class="line"><span class="comment"># 配置开机修改限制</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -n 1000000&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -i 193045&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -l 64&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ulimit -u 1000000&quot;</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure><h2 id="关闭网卡-NAPI-功能"><a href="#关闭网卡-NAPI-功能" class="headerlink" title="关闭网卡 NAPI 功能"></a>关闭网卡 NAPI 功能</h2><p>网卡的 NAPI 功能可能会带来延迟的波动和其他问题，可使用以下命令将其关闭：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ethtool -C eth0 rx-usecs 0</span><br></pre></td></tr></table></figure><h2 id="调整网卡的接收和发送队列"><a href="#调整网卡的接收和发送队列" class="headerlink" title="调整网卡的接收和发送队列"></a>调整网卡的接收和发送队列</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前网卡的队列长度</span></span><br><span class="line">ethtool -g eth0</span><br><span class="line"><span class="comment"># 修改 eth0 接收和发送队列长度为 4096</span></span><br><span class="line">ethtool -G eth0 rx 4096</span><br><span class="line">ethtool -G eth0 tx 4096</span><br><span class="line"><span class="comment"># 增加 txqueuelen</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 txqueuelen 4096</span><br><span class="line"><span class="comment"># 如果在运行旧版本内核, 应手动增加 txqueuelen 到 1000</span></span><br><span class="line">ifconfig eth0 txqueuelen 1000</span><br></pre></td></tr></table></figure><h2 id="增大-Swap-分区"><a href="#增大-Swap-分区" class="headerlink" title="增大 Swap 分区"></a>增大 Swap 分区</h2><p>推荐设置的 Swap 分区大小和内存大小的对应关系如下表：</p><table><thead><tr><th>内存大小</th><th>推荐的 Swap 分区大小</th></tr></thead><tbody><tr><td>小于 4g</td><td>4G</td></tr><tr><td>4-16G</td><td>8G</td></tr><tr><td>16-64G</td><td>16G</td></tr><tr><td>64-256G</td><td>32G</td></tr></tbody></table><p>可使用如下命令改变创建新的 Swap 文件并设置开启自动启用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前分区状况</span></span><br><span class="line">free -m</span><br><span class="line"><span class="comment"># 关闭所有 Swap</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="comment"># 创建新的 Swap 文件: 块大小为 1MB (1048576 bytes)，数量为 4096</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/swapfile bs=1M count=4096</span><br><span class="line"><span class="comment"># 设置文件为 Swap</span></span><br><span class="line">mkswap /var/swapfile</span><br><span class="line"><span class="comment"># 启用 Swap 分区</span></span><br><span class="line">swapon /var/swapfile</span><br><span class="line"><span class="comment"># 查看当前分区状况</span></span><br><span class="line">free -m</span><br><span class="line"><span class="comment"># 设置开启启动</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="comment"># ========================================</span></span><br><span class="line">/var/swapfile swap swap defaults 0 0</span><br><span class="line"><span class="comment"># ========================================</span></span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/networking/ip-sysctl.html">IP Sysctl — The Linux Kernel documentation</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/MssGuo/article/details/120586496">Linux 如何增大、缩小 swap 分区</a></li><li><a target="_blank" rel="noopener" href="https://gist.github.com/voluntas/bc54c60aaa7ad6856e6f6a928b79ab6c">Sysctl configuration for high performance</a></li><li><a target="_blank" rel="noopener" href="https://access.redhat.com/sites/default/files/attachments/20150325_network_performance_tuning.pdf">Red Hat Enterprise Linux Network Performance Tuning Guide</a></li><li><a target="_blank" rel="noopener" href="https://wiki.linuxfoundation.org/networking/napi#disadvantages">networking:napi</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Windows 系统新装优化指南</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-05-08 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-08T00:00:00+08:00">2023-05-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="安装驱动和基本软件：驱动装完再装软件"><a href="#安装驱动和基本软件：驱动装完再装软件" class="headerlink" title="安装驱动和基本软件：驱动装完再装软件"></a>安装驱动和基本软件：驱动装完再装软件</h2><p>驱动安装顺序：</p><ol><li>主板相关驱动</li><li>BIOS 更新（如果有）</li><li>显卡、网卡、声卡</li><li>其他驱动</li><li>配套软件</li><li>杀软（如果需要）</li></ol><h2 id="使用-Dism-卸载系统无用软件并关闭系统更新"><a href="#使用-Dism-卸载系统无用软件并关闭系统更新" class="headerlink" title="使用 Dism++ 卸载系统无用软件并关闭系统更新"></a>使用 Dism++ 卸载系统无用软件并关闭系统更新</h2><p>若软件在用户应用和预装应用里都有，那么先在用户应用中删除再在预装应用中删除</p><ul><li>有用的 Appx<ul><li>应用商店相关</li><li>UI 相关</li><li>各种 VCLibs</li><li>.NET 环境</li><li>Webp、VP9、HEIF 等格式扩展支持</li><li>画图、截图等</li></ul></li></ul><h2 id="关闭无用的服务"><a href="#关闭无用的服务" class="headerlink" title="关闭无用的服务"></a>关闭无用的服务</h2><p><img data-src="/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/%E7%A6%81%E7%94%A8%E6%9C%8D%E5%8A%A1_1.webp"></p><p><img data-src="/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/%E7%A6%81%E7%94%A8%E6%9C%8D%E5%8A%A1_2.webp"></p><p><img data-src="/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/%E7%A6%81%E7%94%A8%E6%9C%8D%E5%8A%A1_3.webp"></p><p><img data-src="/hexo-blog/2023/05/07/Windows-%E7%B3%BB%E7%BB%9F%E6%96%B0%E8%A3%85%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/%E7%A6%81%E7%94%A8%E6%9C%8D%E5%8A%A1_4.webp"></p><p>对需要禁用的服务说明如下：</p><ul><li>AVCTP 服务：蓝牙耳机相关</li><li>Hyper-V 相关服务：HV 主机相关</li><li>Edge 更新服务：新版 Edge 相关</li><li>Smart Card 开头的服务：智能卡相关</li><li>SSDP Discovery、Function Discovery Provider Host、UPnP Device Host、Function Discovery Resource Publication：Upnp、SSDP 服务</li><li>Shell Hardware Detection：自动播放功能</li><li>Quality Windows Audio Video Experience：可禁用</li><li>Windows Search：务必关闭</li><li>SysMain：使用固态硬盘的请关闭</li><li>IP Helper：提供 IPv6 到 IPv4 的转换，不使用 IPv6 的可以关闭</li><li>TCP&#x2F;IP NetBIOS Helper：提供 NetBIOS 相关功能</li><li>Print 开头的三项服务：提供打印相关服务，不使用打印机的可以关闭</li><li>无线网卡搜不到网络的，一般都是因为无线电管理服务被禁用了</li><li>带 <code>_xxxxx</code> 后缀的服务可能在服务里调整不了，需到注册表的 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\</code> 目录下调整（2 自动，3 手动，4 禁用）<ul><li>BcastDVRUserService_xxx Xbox 游戏录制，根据需求选择 3&#x2F;4</li><li>BluetoothUserService_xxx 蓝牙服务，建议 3</li><li>ConsentUxUserSvc_xxx、DevicesFlowUserSvc_xxx、DevicePickerUserSvc_xxx、DeviceAssociationBrokerSvc_xxx、UdkUserSvc_xxx 连接设备时可能会用到，建议 3</li><li>CaptureService_xxx 截图工具可能会用到的 api，建议 3</li><li>cbdhsvc_xxx 剪贴板，建议 2&#x2F;3</li><li>CDPUserSvc_xxx 同步用户设置、隐私等数据用的，想保护隐私的选 3，需要这项功能的选 2</li><li>CredentialEnrollmentManagerUserSvc_xxx 凭据管理器，存储密码用的，建议 2&#x2F;3</li><li>MessagingService_xxx 需要短信功能的 3，不用的 4</li><li>UnistoreSvc_xxx、UserDataSvc_xxx、储存、访问联系人、邮件等用户数据，需要用的 3，不用的 4</li><li>PimIndexMaintenanceSvc_xxx 联系人相关，用的 3，不用的 4</li><li>PrintWorkflowUserSvc_xxx 打印机相关，选 3</li><li>WpnUserService_xxx 推送系统通知用的，选 2</li><li>OneSyncSvc、OneSyncSvc_xxxx 不需要同步的可以 4</li></ul></li></ul><h2 id="释放系统预留的-7G-空间"><a href="#释放系统预留的-7G-空间" class="headerlink" title="释放系统预留的 7G 空间"></a>释放系统预留的 7G 空间</h2><p><code>DISM.exe /Online /Set-ReservedStorageState /State:Disabled</code></p><h2 id="避免微软输入法卡顿"><a href="#避免微软输入法卡顿" class="headerlink" title="避免微软输入法卡顿"></a>避免微软输入法卡顿</h2><p>右键输入法，设置 -&gt; 常规，在兼容性里选择使用以前版本的微软输入法</p><h2 id="解决提示需要新应用打开此-ms-screenclip-链接"><a href="#解决提示需要新应用打开此-ms-screenclip-链接" class="headerlink" title="解决提示需要新应用打开此 ms-screenclip 链接"></a>解决提示需要新应用打开此 ms-screenclip 链接</h2><p><code>DISM /Online /Add-Capability /CapabilityName:Windows.Client.ShellComponents~~~~0.0.1.0</code></p><h2 id="推荐精简版系统"><a href="#推荐精简版系统" class="headerlink" title="推荐精简版系统"></a>推荐精简版系统</h2><p>远景论坛 <strong>不忘初心</strong> 大神的各类精简版系统</p><h2 id="右键菜单管理"><a href="#右键菜单管理" class="headerlink" title="右键菜单管理"></a>右键菜单管理</h2><p><a target="_blank" rel="noopener" href="https://github.com/BluePointLilac/ContextMenuManager">GitHub - BluePointLilac&#x2F;ContextMenuManager: 🖱️ 纯粹的 Windows 右键菜单管理程序</a></p><h2 id="解决-AMD-CPU-卡顿的问题"><a href="#解决-AMD-CPU-卡顿的问题" class="headerlink" title="解决 AMD CPU 卡顿的问题"></a>解决 AMD CPU 卡顿的问题</h2><p>关闭 BIOS 中的 <code>AMD Platform Security Processor</code></p><h2 id="Windows-11-改回-Windows-10-的右键菜单"><a href="#Windows-11-改回-Windows-10-的右键菜单" class="headerlink" title="Windows 11 改回 Windows 10 的右键菜单"></a>Windows 11 改回 Windows 10 的右键菜单</h2><p>打开 cmd 并输入 <code>reg add &quot;HKCU\Software\Classes\CLSID\&#123;86ca1aa0-34aa-4e8b-a509-50c905bae2a2&#125;\InprocServer32&quot; /f /ve</code> 后重启资源管理器即可生效。要恢复为 Windows 11 右键菜单，则使用命令：<code>reg delete &quot;HKCU\Software\Classes\CLSID\&#123;86ca1aa0-34aa-4e8b-a509-50c905bae2a2&#125;&quot; /f</code></p><h2 id="CPU-响应速度优化"><a href="#CPU-响应速度优化" class="headerlink" title="CPU 响应速度优化"></a>CPU 响应速度优化</h2><p>下载软件 QuickCPU，将左下角 Core Parking、Frequency Scaling、Turbo boost、Performance 全部拉满即可。</p><h2 id="加速系统响应速度"><a href="#加速系统响应速度" class="headerlink" title="加速系统响应速度"></a>加速系统响应速度</h2><p>注册表找到 <code>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management</code>，根据屏幕分辨率修改 SessionPoolSize 和 SessionViewSize</p><ul><li>SessionPoolSize：1080P 改为 62K 改为 12，4K 改为 24</li><li>SessionViewSize：1080P 改为 62，2K 改为 144，4K 改为 288</li></ul><h2 id="针对-Ryzen-笔记本的优化"><a href="#针对-Ryzen-笔记本的优化" class="headerlink" title="针对 Ryzen 笔记本的优化"></a>针对 Ryzen 笔记本的优化</h2><h3 id="风扇转速"><a href="#风扇转速" class="headerlink" title="风扇转速"></a>风扇转速</h3><ol><li><p>使用软件 atrofac</p></li><li><p>点击 Edit Configuration 配置，常用的配置如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 极度安静</span><br><span class="line">cpu_curve:&quot;30c:0%,40c:0%,50c:0%,60c:0%,70c:10%,80c:20%,90c:60%,100c:99%&quot;</span><br><span class="line"># 中度安静</span><br><span class="line">cpu_curve: &quot;30c:5%,40c:5%,50c:5%,60c:5%,70c:30%,80c:55%,90c:78%,100c:99%&quot;</span><br><span class="line"># 玩游戏时</span><br><span class="line">cpu_curve:&quot;30c:30%,40c:30%,50c:30%,60c:30%,70c:99%,80c:99%,90c:99%,100c:99%&quot;</span><br></pre></td></tr></table></figure></li></ol><h3 id="开启性能模式"><a href="#开启性能模式" class="headerlink" title="开启性能模式"></a>开启性能模式</h3><ol><li>运行 regedit 打开注册表</li><li>找到 <code>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\54533251-82be-4824-96c1-47b60b740d00\be337238-0d82-4146-a960-4f3749d470c7</code>，修改右侧 Attributes 修改值为 2</li><li>在电源管理中可以看到处理器性能提升模式，启用可以开启睿频，关闭可关闭睿频</li></ol><h3 id="调整-AMD-CPU-核显的-TDP-修正周期"><a href="#调整-AMD-CPU-核显的-TDP-修正周期" class="headerlink" title="调整 AMD CPU 核显的 TDP 修正周期"></a>调整 AMD CPU 核显的 TDP 修正周期</h3><ol><li>使用软件 <code>AMD APUTuning Utility</code></li><li>在 <code>Pre-Made Presets</code> 中找到自己的处理器应用即可</li></ol><h3 id="延长电池寿命"><a href="#延长电池寿命" class="headerlink" title="延长电池寿命"></a>延长电池寿命</h3><ol><li>使用软件 <code>MyASUS</code></li><li>设置笔记本充满电电量为 60%</li></ol><h2 id="FPS-禁用全屏优化"><a href="#FPS-禁用全屏优化" class="headerlink" title="FPS 禁用全屏优化"></a>FPS 禁用全屏优化</h2><p>打开注册表，进入 <code>计算机\HKEY_CURRENT_USER\System\GameConfigStore</code></p><ul><li>GameDVR_FSEBehaviorMode：2</li><li>GameDVR_HonorUserFSEBehaviorMode：1</li><li>GameDVR_FSEBehavior：2</li><li>GameDVR_DXGIHonorFSEWindowsCompatible：1</li></ul><h2 id="笔记本配置触控板手势"><a href="#笔记本配置触控板手势" class="headerlink" title="笔记本配置触控板手势"></a>笔记本配置触控板手势</h2><ol><li>Windows 10 进入 设置 -&gt; 设备 -&gt; 触摸板 -&gt; 高级手势配置 设置自定义手势</li><li>个人使用的设置<ul><li>三指点击：关闭 (Ctrl+W)</li><li>三指向上轻扫：向后导航</li><li>三指向下轻扫：回到桌面 (Win+D)</li><li>三指向左轻扫：切换应用 (Alt+Tab)</li><li>三指向右轻扫：切换应用 (Alt+Tab)</li><li>四指点击：播放 &#x2F; 暂停</li><li>四指向上轻扫：添加新的标签页 (Ctrl+T)</li><li>四指向下轻扫：关闭当前页面 (Ctrl+W)</li><li>四指向左轻扫：上一个标签 (Ctrl+Shift+Tab)</li><li>四指向右轻扫：下一个标签 (Ctrl+Tab)</li></ul></li></ol><h2 id="关闭-Virtualization-based-Security"><a href="#关闭-Virtualization-based-Security" class="headerlink" title="关闭 Virtualization-based Security"></a>关闭 Virtualization-based Security</h2><ol><li>按 Win+S，输入 System Information 或 msinfo32，如果 Virtualization-based security 为 Running 则已启用</li><li>按 Win+S，输入 Core Isolation，将内存完整性保护关闭</li><li>运行 regedit，进入 <code>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\DeviceGuard</code>，新建 DWORD <code>EnableVirtualizationBasedSecurity</code> 并赋值 0</li></ol><h2 id="彻底关闭-Hyper-V-虚拟机"><a href="#彻底关闭-Hyper-V-虚拟机" class="headerlink" title="彻底关闭 Hyper-V 虚拟机"></a>彻底关闭 Hyper-V 虚拟机</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /<span class="built_in">set</span> hypervisorlaunchtype off</span><br></pre></td></tr></table></figure><h2 id="重置所有系统应用"><a href="#重置所有系统应用" class="headerlink" title="重置所有系统应用"></a>重置所有系统应用</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入 Y 并回车</span></span><br><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Unrestricted</span><br><span class="line"><span class="built_in">Get-AppXPackage</span> <span class="literal">-AllUsers</span> | <span class="keyword">Foreach</span> &#123;<span class="built_in">Add-AppxPackage</span> <span class="literal">-DisableDevelopmentMode</span> <span class="literal">-Register</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$_</span>.InstallLocation)\AppXManifest.xml&quot;</span>&#125;</span><br><span class="line"><span class="built_in">Get-AppxPackage</span> Microsoft.SecHealthUI <span class="literal">-AllUsers</span> | <span class="built_in">Reset-AppxPackage</span></span><br></pre></td></tr></table></figure><h2 id="关闭笔记本-S0-睡眠状态"><a href="#关闭笔记本-S0-睡眠状态" class="headerlink" title="关闭笔记本 S0 睡眠状态"></a>关闭笔记本 S0 睡眠状态</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询系统固件支持哪些睡眠状态</span></span><br><span class="line">powercfg /a</span><br><span class="line"><span class="comment"># 关闭 S0 睡眠状态</span></span><br><span class="line">reg add <span class="string">&quot;HKLM\System\CurrentControlSet\Control\Power&quot;</span> /v PlatformAoAcOverride /t REG_DWORD /d <span class="number">0</span></span><br><span class="line"><span class="comment"># 重新开启 S0 睡眠状态</span></span><br><span class="line">reg delete <span class="string">&quot;HKLM\System\CurrentControlSet\Control\Power&quot;</span> /v PlatformAoAcOverride /f</span><br></pre></td></tr></table></figure><h2 id="优化系统-MTU"><a href="#优化系统-MTU" class="headerlink" title="优化系统 MTU"></a>优化系统 MTU</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前使用的 MTU 大小</span></span><br><span class="line">netsh interface ipv4 show subinterfaces</span><br><span class="line"><span class="comment"># 使 -l 后的参数最大但可 ping 通</span></span><br><span class="line">ping baidu.com <span class="operator">-f</span> <span class="literal">-l</span> <span class="number">1464</span></span><br><span class="line"><span class="comment"># 将得到的数值加 28</span></span><br><span class="line"><span class="comment"># 本机设置, 也可在路由器设置</span></span><br><span class="line">netsh int ipv4 <span class="built_in">set</span> subinterface <span class="string">&quot;本地连接&quot;</span> mtu=<span class="number">1492</span> store=persistent</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/04/29/%E5%85%B3%E4%BA%8E-Project-Sekai-%E9%94%81%E5%8C%BA%E5%92%8C%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/04/29/%E5%85%B3%E4%BA%8E-Project-Sekai-%E9%94%81%E5%8C%BA%E5%92%8C%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">关于 Project Sekai 锁区和无法进入游戏的解决方案</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-04-30 00:00:00" itemprop="dateCreated datePublished" datetime="2023-04-30T00:00:00+08:00">2023-04-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>Project Sekai: Colorful Stage! feat. Hatsune Miku</code>（以下简称 <code>PJSK</code>）是世嘉开发的一款音乐游戏，在进入游戏的过程中会检测玩家 IP 是否在允许列表中，如果不在则会禁止玩家登录。无法登录游戏的常见情况有如下几种：</p><ol><li><p>提示 <code>会话已过期，返回标题界面</code>（如图），这种情况一般是 IP 不在允许登录的范围内，即 <strong>被锁区</strong></p><p><img data-src="/hexo-blog/2023/04/29/%E5%85%B3%E4%BA%8E-Project-Sekai-%E9%94%81%E5%8C%BA%E5%92%8C%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/1682833256196.webp"></p></li><li><p>依次出现两个弹窗，第一个提示 <code>发生通信错误</code>，第二个提示 <code>回到标题界面</code>，一般是网络不稳定造成的，不能确定是否被锁区</p><p><img data-src="/hexo-blog/2023/04/29/%E5%85%B3%E4%BA%8E-Project-Sekai-%E9%94%81%E5%8C%BA%E5%92%8C%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/1682833260822.webp"></p><p><img data-src="/hexo-blog/2023/04/29/%E5%85%B3%E4%BA%8E-Project-Sekai-%E9%94%81%E5%8C%BA%E5%92%8C%E6%97%A0%E6%B3%95%E8%BF%9B%E5%85%A5%E6%B8%B8%E6%88%8F%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/1682833264335.webp"></p></li><li><p>进入游戏登录界面并点击后又返回登录界面，并且无任何弹窗提示，这种和第二种情况类似，一般为网络原因</p></li></ol><h2 id="锁区原理探究"><a href="#锁区原理探究" class="headerlink" title="锁区原理探究"></a>锁区原理探究</h2><p>对于以上的第二和第三种情况，请检查网络问题并重试，这里重点讨论第一种情况（被锁区）的解决方案。</p><p>在进入游戏的过程中主要向以下几个域名发起连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cdp.cloud.unity3d.com</span><br><span class="line">config.uca.cloud.unity3d.com</span><br><span class="line">production-xxxxxxxx-assetbundle.sekai.colorfulpalette.org</span><br><span class="line">production-xxxxxxxx-assetbundle-info.sekai.colorfulpalette.org</span><br><span class="line">issue.sekai.colorfulpalette.org</span><br><span class="line">game-version.sekai.colorfulpalette.org</span><br></pre></td></tr></table></figure><p>以下域名是 unity 用于收集分析数据的（见 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46045805/why-my-game-is-trying-to-connect-to-external-server">https://stackoverflow.com/questions/46045805/why-my-game-is-trying-to-connect-to-external-server</a>），这两个域名在进入游戏 Rizline 时也会出现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cdp.cloud.unity3d.com</span><br><span class="line">config.uca.cloud.unity3d.com</span><br></pre></td></tr></table></figure><p>以下域名为游戏中分发静态资源（例如音乐、谱面文件和图片等）的域名，其中 <code>xxxxxxxx</code> 为八位字母和数字组合</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">production-xxxxxxxx-assetbundle.sekai.colorfulpalette.org</span><br><span class="line">production-xxxxxxxx-assetbundle-info.sekai.colorfulpalette.org</span><br></pre></td></tr></table></figure><p>以下域名用于 <strong>游戏结束</strong> 上传成绩时和服务器通信：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">production-web.sekai.colorfulpalette.org</span><br><span class="line">production-game-api.sekai.colorfulpalette.org</span><br></pre></td></tr></table></figure><p>以下域名用于在 <strong>登录游戏</strong> 时验证玩家 IP 是否在允许范围内（是否解锁），如果不是则会出现无法进入游戏的情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">issue.sekai.colorfulpalette.org</span><br><span class="line">game-version.sekai.colorfulpalette.org</span><br></pre></td></tr></table></figure><p>解决锁区问题的核心就是 <strong>以上两个域名</strong> 需要通过官方允许的 IP 向服务器发起连接。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>以 Clash 为例，首先创建一个类型为 <code>select</code> 的策略组，将可用节点添加到策略组中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">プロセカ</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">use:</span> [<span class="string">机场1</span>, <span class="string">机场2</span>, <span class="string">...</span>]</span><br></pre></td></tr></table></figure><p>接下来需要将域名 <code>issue.sekai.colorfulpalette.org</code> 和 <code>game-version.sekai.colorfulpalette.org</code> 分流到 <code>プロセカ</code> 策略组，对应 Clash 分流规则如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,issue.sekai.colorfulpalette.org,プロセカ</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">DOMAIN,game-version.sekai.colorfulpalette.org,プロセカ</span></span><br></pre></td></tr></table></figure><p>最后，我们还需要逐一测试 <code>プロセカ</code> 策略组中节点是否解锁，具体方法如下：</p><ol><li><p>在选择节点之后直接登录游戏，检查是否能正常进入游戏</p></li><li><p>使用 curl 或其他 HTTP 请求工具向 <code>game-version.sekai.colorfulpalette.org</code> 域名发送请求，观察返回结果</p><ul><li><p>解锁失败情况下的返回结果如下，此时登录游戏会提示 <code>会话已过期，返回标题界面</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">&quot;text/html; charset=iso-8859-1&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ERROR: The request could not be satisfied<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>403 ERROR<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>The request could not be satisfied.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> <span class="attr">noshade</span> <span class="attr">size</span>=<span class="string">&quot;1px&quot;</span> /&gt;</span></span><br><span class="line">    Request blocked. We can&#x27;t connect to the server for this app or website</span><br><span class="line">    at this time. There might be too much traffic or a configuration error.</span><br><span class="line">    Try again later, or contact the app or website owner.</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> <span class="attr">clear</span>=<span class="string">&quot;all&quot;</span> /&gt;</span></span><br><span class="line">    If you provide content to customers through CloudFront, you can find</span><br><span class="line">    steps to troubleshoot and help prevent this error by reviewing the</span><br><span class="line">    CloudFront documentation.</span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> <span class="attr">clear</span>=<span class="string">&quot;all&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> <span class="attr">noshade</span> <span class="attr">size</span>=<span class="string">&quot;1px&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line">Generated by cloudfront (CloudFront)</span><br><span class="line">Request ID: qcVUtioo_xAhsMx7Q-AfWC5c-X72Abmr-fM8mv2clNXfPoJ5g3kr3g==</span><br><span class="line">&lt;/pre</span><br><span class="line">    &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">address</span>&gt;</span><span class="tag">&lt;/<span class="name">address</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>解锁成功时返回的结果如下，此时能正常进入游戏</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Error</span>&gt;</span><span class="tag">&lt;<span class="name">Code</span>&gt;</span>AccessDenied<span class="tag">&lt;/<span class="name">Code</span>&gt;</span><span class="tag">&lt;<span class="name">Message</span>&gt;</span>Access Denied<span class="tag">&lt;/<span class="name">Message</span>&gt;</span><span class="tag">&lt;<span class="name">RequestId</span>&gt;</span>EJ865XKG7EW1Z5W6<span class="tag">&lt;/<span class="name">RequestId</span>&gt;</span><span class="tag">&lt;<span class="name">HostId</span>&gt;</span>NhL8N6Fxgtpk4slR/6b+DSFiYhSscjPtujrr7ZKudMEgrJPn9Rd2qlBTvx02KIV3twIrtpQZkwg=<span class="tag">&lt;/<span class="name">HostId</span>&gt;</span><span class="tag">&lt;/<span class="name">Error</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="节点解锁一键测试脚本"><a href="#节点解锁一键测试脚本" class="headerlink" title="节点解锁一键测试脚本"></a>节点解锁一键测试脚本</h2><p>由于 Clash 提供的 RESTful API，可以用于获取节点信息、修改策略组选中的节点。因此，测试节点是否解锁的过程可以自动化，同时避免了每次进入游戏之前都要手动选择节点的麻烦。</p><p>我为 Clash 编写的 Python 脚本如下，每次进入游戏之前运行一次即可自动已解锁的节点（注意修改相应信息）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试当前选中节点是否解锁</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_unlock</span>() -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = requests.get(</span><br><span class="line">            <span class="string">&quot;https://game-version.sekai.colorfulpalette.org&quot;</span>,</span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;UnityPlayer/2019.4.3f1&quot;</span></span><br><span class="line">                <span class="string">&quot;(UnityWebRequest/1.0, libcurl/7.52.0-DEV)&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;❌解锁失败&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = r.text.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;!DOCTYPE&quot;</span> <span class="keyword">in</span> res <span class="keyword">and</span> <span class="string">&quot;Request blocked.&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;❌解锁失败&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;&lt;?xml&quot;</span> <span class="keyword">in</span> res <span class="keyword">and</span> <span class="string">&quot;AccessDenied&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;✔解锁成功&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;❓未知状态&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(res)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设使用的策略组名称为 `プロセカ`</span></span><br><span class="line">url = <span class="string">&quot;http://192.168.1.11:9090/proxies/プロセカ&quot;</span></span><br><span class="line"><span class="comment"># 获取 `プロセカ` 策略组中的所有节点名称</span></span><br><span class="line">r = requests.get(url)</span><br><span class="line">all_proxies = r.json().get(<span class="string">&quot;all&quot;</span>)</span><br><span class="line"><span class="comment"># 对每个节点分别测试, 找到第一个解锁成功的节点马上退出</span></span><br><span class="line"><span class="keyword">for</span> proxy <span class="keyword">in</span> all_proxies:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;正在测试 <span class="subst">&#123;proxy&#125;</span>: &quot;</span>, end=<span class="string">&quot;\t\t&quot;</span>)</span><br><span class="line">    r = requests.put(url, json=&#123;<span class="string">&quot;name&quot;</span>: proxy&#125;)</span><br><span class="line">    ok = test_unlock()</span><br><span class="line">    <span class="keyword">if</span> ok:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;使用节点 <span class="subst">&#123;proxy&#125;</span> 解锁成功！&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;全部节点解锁失败！&quot;</span>)</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/03/29/ChatGPT-%E9%95%9C%E5%83%8F%E7%AB%99%E6%B1%87%E6%80%BB/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/03/29/ChatGPT-%E9%95%9C%E5%83%8F%E7%AB%99%E6%B1%87%E6%80%BB/" class="post-title-link" itemprop="url">ChatGPT 镜像站汇总</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2023-03-30T00:00:00+08:00">2023-03-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><table><thead><tr><th>网站</th><th>是否需要 API key</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://chatforai.net/">https://chatforai.net/</a></td><td>可选，单日超过 10 次提问时需要</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chatbot.theb.ai/">https://chatbot.theb.ai/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chat.binjie.site:7777/">https://chat.binjie.site:7777/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chat.forchange.cn/">https://chat.forchange.cn/</a></td><td>是</td></tr><tr><td><a target="_blank" rel="noopener" href="https://aigcfun.com/">https://aigcfun.com/</a></td><td>是</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chat.zecoba.cn/">https://chat.zecoba.cn/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://freegpt.one/">https://freegpt.one/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chatgpt.ddiu.io/">https://chatgpt.ddiu.io/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chat.binjie.site:7777/">https://chat.binjie.site:7777/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://gpt.getshare.net/">https://gpt.getshare.net/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://gpt.xeasy.me/">https://gpt.xeasy.me/</a></td><td>所有用户每天共用 $50 请求</td></tr><tr><td><a target="_blank" rel="noopener" href="https://gpt.tool00.com/">https://gpt.tool00.com/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://trychatgp.com/">https://trychatgp.com/</a></td><td>5 次免费提问，之后需购买</td></tr><tr><td><a target="_blank" rel="noopener" href="https://freegpt.cc/">https://freegpt.cc/</a></td><td>是</td></tr><tr><td><a target="_blank" rel="noopener" href="https://gpt.candobear.com/">https://gpt.candobear.com/</a></td><td>是</td></tr><tr><td><a target="_blank" rel="noopener" href="https://chatgpt-webpage.vercel.app/">https://chatgpt-webpage.vercel.app/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://ffgpt.huijia.cf/">https://ffgpt.huijia.cf/</a></td><td>否</td></tr><tr><td><a target="_blank" rel="noopener" href="https://ai106.com/">https://ai106.com/</a></td><td>否</td></tr></tbody></table></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/" class="post-title-link" itemprop="url">云存储方案的选择</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-02-28 00:00:00" itemprop="dateCreated datePublished" datetime="2023-02-28T00:00:00+08:00">2023-02-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着互联网的不断发展，越来越多用户选择云存储作为自己的存储方案。相对于存储在本地硬盘上，云存储中的内容能随时查看，更加方便。</p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>由于我使用了 Obsidian 作为自己的笔记软件，由于 Obsidian 自带的同步服务每月需要 8 刀实在是一笔巨款，因此用现成的云服务搭建自己的同步方案。</p><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678110958035.png"></p><p>除了能同步笔记，还可用云服务同步 Zotero 文献库、密码数据库和其他需要跨平台访问的资源。</p><p>综上，我对云服务的要求是同步方便，使用场景主要是图片、文档等小文件。</p><p>各种方案的比较及优缺点如下。</p><h2 id="方案选择历程"><a href="#方案选择历程" class="headerlink" title="方案选择历程"></a>方案选择历程</h2><h3 id="坚果云"><a href="#坚果云" class="headerlink" title="坚果云"></a><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/">坚果云</a></h3><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678110876432.png"></p><p>优点：</p><ul><li>上传下载不限速</li><li>增量同步</li><li>服务器在国内，同步快，体验好</li></ul><p>缺点：</p><ul><li>服务器位于国内，由于审查制度的存在，可能会导致一些文件突然消失</li><li>每月 1G 上传流量，对于大文件的场景可能需要付费购买专业版</li><li>使用 WebDAV 连接时对线程数有要求，超过阈值会暂时 503</li></ul><h3 id="Dropbox"><a href="#Dropbox" class="headerlink" title="Dropbox"></a><a target="_blank" rel="noopener" href="https://www.dropbox.com/">Dropbox</a></h3><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678110903465.jpg"></p><p>优点：</p><ul><li>上传下载不限速</li><li>增量同步</li></ul><p>缺点：</p><ul><li>需要科学上网</li><li>2G 的初始容量捉襟见肘，需要邀请其他用户来获得更多容量（可以购买成品号）</li></ul><h3 id="MEGA"><a href="#MEGA" class="headerlink" title="MEGA"></a><a target="_blank" rel="noopener" href="https://mega.nz/">MEGA</a></h3><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678110909238.png"></p><blockquote><p>MEGA 的主要开发者达康表示 MEGA 使用 AES 进行客户端加密，由于 MEGA 服务器端不知道上传文件的加密密钥，因此无法解密和查看内容。因此，他们不对用户上传文件的内容负责。达康还表示，文件的加密允许他们与世界各地数据托管公司合作，减少政府和 ISP 检测服务器的内容的审查。他在接受 Ars Technica 的采访时提到“每个文件至少分别存储在两个地理位置不同的托管服务器上(Each file will be kept with at least two different hosters [sic], [in] at least two different locations)”“这对我们的好处是显而易见的，就算你可以与最小，最不可靠的托管公司合作也没关系，因为他们无法对存储数据做任何事情(That’s a great added benefit for us because you can work with the smallest, most unreliable [hosting] companies. It doesn’t matter because they can’t do anything with that data.)”。</p><p>—— <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/MEGA#%E9%9A%90%E7%A7%81">https://zh.wikipedia.org/zh-hans/MEGA#%E9%9A%90%E7%A7%81</a></p></blockquote><p>MEGA 网盘十分注重用户的隐私，同时上传的文件不会被审查，适合存储对隐私性要求较高的数据。</p><p>优点：</p><ul><li>上传下载不限速</li><li>初始容量 20G，对于笔记、文档等小文件完全够用</li><li>端到端加密，隐私友好</li></ul><p>缺点：</p><ul><li>需要科学上网</li><li>不支持增量同步</li><li>云端文件改动较大时接收客户端会频繁崩溃，体验较差（不知道是否是个例）</li></ul><h2 id="转机"><a href="#转机" class="headerlink" title="转机"></a>转机</h2><p>某一天，在逛 V2EX 论坛的时候，我发现了 Rclone 这个神器，它可以实现命令行管理云存储，也就是说可以编写脚本一键同步到云端或一键下载到本地，极大地简化了同步步骤。另外，配合计划任务还可以实现无感同步。</p><p>Rclone 的功能包括同步、传输、加密、缓存和挂载，支持 Amazon S3（兼容大部分 OSS 对象存储）、Google Drive、Dropbox、OneDrive 等共五十多种云存储服务。</p><p>支持的部分云存储服务如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> 1 / 1Fichier</span><br><span class="line">   \ (fichier)</span><br><span class="line"> 2 / Akamai NetStorage</span><br><span class="line">   \ (netstorage)</span><br><span class="line"> 3 / Alias <span class="keyword">for</span> an existing remote</span><br><span class="line">   \ (<span class="built_in">alias</span>)</span><br><span class="line"> 4 / Amazon Drive</span><br><span class="line">   \ (amazon cloud drive)</span><br><span class="line"> 5 / Amazon S3 Compliant Storage Providers</span><br><span class="line">   \ (s3)</span><br><span class="line"> 6 / Backblaze B2</span><br><span class="line">   \ (b2)</span><br><span class="line"> 7 / Better checksums <span class="keyword">for</span> other remotes</span><br><span class="line">   \ (hasher)</span><br><span class="line"> 8 / Box</span><br><span class="line">   \ (box)</span><br><span class="line"> 9 / Cache a remote</span><br><span class="line">   \ (cache)</span><br><span class="line">10 / Citrix Sharefile</span><br><span class="line">   \ (sharefile)</span><br><span class="line">11 / Combine several remotes into one</span><br><span class="line">   \ (combine)</span><br><span class="line">12 / Compress a remote</span><br><span class="line">   \ (compress)</span><br><span class="line">13 / Dropbox</span><br><span class="line">   \ (dropbox)</span><br><span class="line">14 / Encrypt/Decrypt a remote</span><br><span class="line">   \ (crypt)</span><br><span class="line">15 / Enterprise File Fabric</span><br><span class="line">   \ (filefabric)</span><br><span class="line">16 / FTP</span><br><span class="line">   \ (ftp)</span><br><span class="line">17 / Google Cloud Storage (this is not Google Drive)</span><br><span class="line">   \ (google cloud storage)</span><br><span class="line">18 / Google Drive</span><br><span class="line">   \ (drive)</span><br><span class="line">19 / Google Photos</span><br><span class="line">   \ (google photos)</span><br><span class="line">20 / HTTP</span><br><span class="line">   \ (http)</span><br><span class="line">21 / Hadoop distributed file system</span><br><span class="line">   \ (hdfs)</span><br><span class="line">22 / HiDrive</span><br><span class="line">   \ (hidrive)</span><br><span class="line">23 / In memory object storage system.</span><br><span class="line">   \ (memory)</span><br><span class="line">24 / Internet Archive</span><br><span class="line">   \ (internetarchive)</span><br><span class="line">25 / Jottacloud</span><br><span class="line">   \ (jottacloud)</span><br><span class="line">26 / Koofr, Digi Storage and other Koofr-compatible storage providers</span><br><span class="line">   \ (koofr)</span><br><span class="line">27 / Local Disk</span><br><span class="line">   \ (<span class="built_in">local</span>)</span><br><span class="line">28 / Mail.ru Cloud</span><br><span class="line">   \ (mailru)</span><br><span class="line">29 / Mega</span><br><span class="line">   \ (mega)</span><br><span class="line">30 / Microsoft Azure Blob Storage</span><br><span class="line">   \ (azureblob)</span><br><span class="line">31 / Microsoft OneDrive</span><br><span class="line">   \ (onedrive)</span><br><span class="line">32 / OpenDrive</span><br><span class="line">   \ (opendrive)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>到这里，需要找的云产品应该支持 WebDAV 或可在 Rclone 中直接使用，我个人使用过的方案如下。</p><h3 id="Rclone-阿里云对象存储"><a href="#Rclone-阿里云对象存储" class="headerlink" title="Rclone + 阿里云对象存储"></a>Rclone + <a target="_blank" rel="noopener" href="https://www.aliyun.com/product/oss">阿里云对象存储</a></h3><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678111000230.png"></p><p>阿里云对象存储的标准存储方案可使用 Amazon S3 协议添加到 Rclone 中使用，价格为 9 元&#x2F;年，四舍五入等于不花钱。实际使用后我发现由于使用 Rclone 同步文件每次需要比对全部文件，这会产生大量 API 调用，而调用 API 次数每月有限制，会产生额外费用。</p><p>另外，由于是国内的服务，存在审查制度，文件安全性不能得到保障。</p><h3 id="Rclone-OneDrive-Global"><a href="#Rclone-OneDrive-Global" class="headerlink" title="Rclone + OneDrive Global"></a>Rclone + OneDrive Global</h3><p>Rclone 直接支持微软 OneDrive，在客户端中直接输入 client_id 和 client_secret 就可以连接了。</p><p>在使用过程中我发现 OneDrive 对 API 调用有限制，短时间大量请求或大量传输可能会触发限制，出现 <code>The request has been throttled</code>。官方文档中对此问题的说明如下：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online">https://learn.microsoft.com/en-us/sharepoint/dev/general-development/how-to-avoid-getting-throttled-or-blocked-in-sharepoint-online</a>。</p><p>该问题可以通过使用 Rclone 的 <code>--tpslimit</code> 限制每秒的传输量来解决，但是有没有一种方案能够实现无限制传输呢？</p><h3 id="Rclone-TeraCloud"><a href="#Rclone-TeraCloud" class="headerlink" title="Rclone + TeraCloud"></a>Rclone + TeraCloud</h3><p><img data-src="/hexo-blog/2023/02/27/%E4%BA%91%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9/1678111010836.png"></p><p>这是我目前在使用的方案，在国内不用科学上网即可使用。传输的速度尚可，且支持 WebDAV。注册完成后，可在 <a target="_blank" rel="noopener" href="https://teracloud.jp/en/modules/mypage/usage/">https://teracloud.jp/en/modules/mypage/usage/</a> 页面的 App Connections 部分获取 WebDAV 链接、Connection ID 和 Apps Password。</p><p>注册完成后在上面页面输入邀请码：<code>VYJGU</code>，我们都能获得 5GB 的永久免费空间。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/01/25/%E5%8A%A0%E5%AF%86%E5%85%AC%E5%85%B1-DNS-%E5%9C%B0%E5%9D%80%E6%B1%87%E6%80%BB/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/01/25/%E5%8A%A0%E5%AF%86%E5%85%AC%E5%85%B1-DNS-%E5%9C%B0%E5%9D%80%E6%B1%87%E6%80%BB/" class="post-title-link" itemprop="url">加密公共 DNS 地址汇总</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-26 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-26T00:00:00+08:00">2023-01-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="国内"><a href="#国内" class="headerlink" title="国内"></a>国内</h2><h3 id="阿里"><a href="#阿里" class="headerlink" title="阿里"></a>阿里</h3><p>支持 ECS，即使通过 DoH 访问仍然有污染</p><ul><li>DoH：支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://dns.alidns.com/dns-query">https://dns.alidns.com/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://223.5.5.5/dns-query">https://223.5.5.5/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://223.6.6.6/dns-query">https://223.6.6.6/dns-query</a></li></ul></li><li>DoT：<code>dns.alidns.com</code></li></ul><h3 id="腾讯"><a href="#腾讯" class="headerlink" title="腾讯"></a>腾讯</h3><p>不完全支持 ECS，有些地址没有解析到最近的服务器</p><ul><li>DoH：不支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://doh.pub/dns-query">https://doh.pub/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://120.53.53.53/dns-query">https://120.53.53.53/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://1.12.12.12/dns-query">https://1.12.12.12/dns-query</a></li></ul></li><li>DoT：<code>dot.pub</code></li></ul><h3 id="IPv6-DNS"><a href="#IPv6-DNS" class="headerlink" title="IPv6 DNS"></a>IPv6 DNS</h3><p>2025-07-20 更新：已不可用</p><p><del>IPv4 到 IPv6 时代的过渡 DNS，解析准确度与阿里 DNS 相当</del></p><ul><li><del>DoH：不支持 DoH3</del><ul><li><del><a target="_blank" rel="noopener" href="https://dns.ipv6dns.com/dns-query">https://dns.ipv6dns.com/dns-query</a></del></li></ul></li><li><del>DoT：<code>dns.ipv6dns.com</code></del></li></ul><h3 id="Easymos-DNS"><a href="#Easymos-DNS" class="headerlink" title="Easymos DNS"></a>Easymos DNS</h3><p>公益 DNS，上游使用国内的阿里和 DNSPod、国外的 Opendns 和 Google DNS 等，国内国外解析效果均可</p><ul><li>DoH：不支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://doh.apad.pro/dns-query">https://doh.apad.pro/dns-query</a></li></ul></li></ul><h3 id="iQDNS"><a href="#iQDNS" class="headerlink" title="iQDNS"></a>iQDNS</h3><p>2025-07-20 更新：已不可用</p><p><del>隐私至上的公益 DNS，可在 <a target="_blank" rel="noopener" href="https://iqiq.io/servers.html">https://iqiq.io/servers.html</a> 查看完整服务器列表</del></p><p><del>已知缺点：大概率会将 bilibili 负载均衡域名 <code>i0.hdslb.com</code> 解析到香港导致大陆 bilibili 图片加载缓慢</del></p><ul><li><del>DoH：不支持 DoH3</del><ul><li><del><a target="_blank" rel="noopener" href="https://cn-east.iqiqzz.com/dns-query">https://cn-east.iqiqzz.com/dns-query</a></del></li></ul></li><li><del>DoT：<code>cn-east.iqiqzz.com</code></del></li><li><del>DoQ：<code>cn-east.ovo.glass</code></del></li></ul><h3 id="清华-Tuna-DNS"><a href="#清华-Tuna-DNS" class="headerlink" title="清华 Tuna DNS"></a>清华 Tuna DNS</h3><p>不支持 ECS，大多数域名都会解析到北京附近</p><ul><li>DoH：不支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://101.6.6.6:8443/dns-query">https://101.6.6.6:8443/dns-query</a></li></ul></li></ul><h2 id="国外"><a href="#国外" class="headerlink" title="国外"></a>国外</h2><h3 id="Google-DNS"><a href="#Google-DNS" class="headerlink" title="Google DNS"></a>Google DNS</h3><p>支持 ECS</p><ul><li>DoH：支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://dns.google/dns-query">https://dns.google/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://8.8.8.8/dns-query">https://8.8.8.8/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://8.8.4.4/dns-query">https://8.8.4.4/dns-query</a></li></ul></li><li>DoT：<code>dns.google</code></li></ul><h3 id="Cloudflare-DNS"><a href="#Cloudflare-DNS" class="headerlink" title="Cloudflare DNS"></a>Cloudflare DNS</h3><p>注重隐私，不支持 ECS</p><ul><li>DoH：支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://1dot1dot1dot1.cloudflare-dns.com/">https://1dot1dot1dot1.cloudflare-dns.com</a></li><li><a target="_blank" rel="noopener" href="https://1.1.1.1/dns-query">https://1.1.1.1/dns-query</a></li><li><a target="_blank" rel="noopener" href="https://1.0.0.1/dns-query">https://1.0.0.1/dns-query</a></li></ul></li><li>DoT：<code>cloudflare-dns.com</code></li></ul><h3 id="OpenDNS"><a href="#OpenDNS" class="headerlink" title="OpenDNS"></a>OpenDNS</h3><p>支持 ECS</p><ul><li>DoH：不支持 DoH3<ul><li><a target="_blank" rel="noopener" href="https://doh.opendns.com/dns-query">https://doh.opendns.com/dns-query</a></li></ul></li></ul><h3 id="CleanBrowsing"><a href="#CleanBrowsing" class="headerlink" title="CleanBrowsing"></a>CleanBrowsing</h3><p>支持 ECS</p><ul><li>DoH<ul><li>不屏蔽成人内容：<a target="_blank" rel="noopener" href="https://doh.cleanbrowsing.org/doh/security-filter">https://doh.cleanbrowsing.org/doh/security-filter</a></li><li>屏蔽部分成人内容：<a target="_blank" rel="noopener" href="https://doh.cleanbrowsing.org/doh/adult-filter">https://doh.cleanbrowsing.org/doh/adult-filter</a></li><li>屏蔽所有成人内容：<a target="_blank" rel="noopener" href="https://doh.cleanbrowsing.org/doh/family-filter">https://doh.cleanbrowsing.org/doh/family-filter</a></li></ul></li><li>DoT<ul><li>不屏蔽成人内容：<code>security-filter-dns.cleanbrowsing.org</code></li><li>屏蔽部分成人内容：<code>adult-filter-dns.cleanbrowsing.org</code></li><li>屏蔽所有成人内容：<code>family-filter-dns.cleanbrowsing.org</code></li></ul></li></ul><h3 id="DNS-SB"><a href="#DNS-SB" class="headerlink" title="DNS.SB"></a>DNS.SB</h3><p>注重隐私保护，不支持 ECS</p><ul><li>DoH<ul><li><a target="_blank" rel="noopener" href="https://doh.dns.sb/dns-query">https://doh.dns.sb/dns-query</a></li></ul></li></ul><h3 id="AdGuard-DNS"><a href="#AdGuard-DNS" class="headerlink" title="AdGuard DNS"></a>AdGuard DNS</h3><ul><li>DoH<ul><li>过滤广告：<a target="_blank" rel="noopener" href="https://dns.adguard.com/dns-query">https://dns.adguard.com/dns-query</a></li><li>家庭保护：<a target="_blank" rel="noopener" href="https://dns-family.adguard.com/dns-query">https://dns-family.adguard.com/dns-query</a></li><li>不过滤：<a target="_blank" rel="noopener" href="https://dns-unfiltered.adguard.com/dns-query">https://dns-unfiltered.adguard.com/dns-query</a></li></ul></li><li>DoT &#x2F; DoQ<ul><li>过滤广告：<code>dns.adguard.com</code></li><li>家庭保护：<code>dns-family.adguard.com</code></li><li>不过滤：<code>dns-unfiltered.adguard.com</code></li></ul></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/" class="post-title-link" itemprop="url">使用 Mosdns 搭建本地无污染 DNS</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-17 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-17T00:00:00+08:00">2023-01-17</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>国内 DNS 污染越来越严重，特别是移动宽带，运营商分配的 DNS 在解析很多境外网站时会得到污染的结果或直接返回 127.0.0.1（例如 aka.ms）从而导致代理软件失效。虽然上述问题可以在代理软件中使用分流解决，但在本地搭建 DNS 不仅可以实现分流，更可实现部分广告过滤和缓存功能，极大提升了网页浏览体验。</p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951344719.png"></p><h2 id="无污染-DNS-实现原理"><a href="#无污染-DNS-实现原理" class="headerlink" title="无污染 DNS 实现原理"></a>无污染 DNS 实现原理</h2><p>全部 DNS 请求均使用境外无污染 DNS 会导致本地域名解析速度偏慢，且在使用 ECS 的情况下准确度不如国内 DNS，若使用本地 DNS 服务端进行分流则可以兼备快速和准确的优点。</p><h2 id="要实现的目标"><a href="#要实现的目标" class="headerlink" title="要实现的目标"></a>要实现的目标</h2><ol><li>DNS 解析结果无污染</li><li>国内外按域名和 IP 分流</li><li>支持 ECS，能解析到距离最近的 CDN 服务器</li><li>延迟尽可能低</li><li>最好全程使用加密 DNS（DoT、DoH、DoQ 等）</li></ol><h2 id="上游-DNS-选择"><a href="#上游-DNS-选择" class="headerlink" title="上游 DNS 选择"></a>上游 DNS 选择</h2><p>国内 DNS 的选择方面，经过测试发现，使用腾讯 DNS 在国内的出口在广东，解析出的地址不是我所在地区的最优地址，而阿里 DNS 就没有这个问题。</p><p>国外的 DNS 选择 GoogleDNS 和 EasymosDNS 作为上游，EasymosDNS 的上游使用国内阿里 DNS、腾讯的 DNSPod 和国外的 GoogleDNS、OpenDNS 等，搭配 ECS 可实现国外正确解析到距离最近的 CDN。</p><h2 id="分流原理"><a href="#分流原理" class="headerlink" title="分流原理"></a>分流原理</h2><p>由于 mosdns 支持 v2ray 的 dat 文件，因此可直接使用 geoip.dat 匹配 IP 地址，使用 geosite.dat 匹配域名。</p><p>在广告过滤方面，可直接使用 <code>geosite:category-ads-all</code> 进行过滤，也可添加常见的广告过滤规则。这里广告过滤规则只支持域名，示例文件如下：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">example-ad1.com</span><br><span class="line">example-ad2.com</span><br></pre></td></tr></table></figure><p>我使用了 oisd 的 <a target="_blank" rel="noopener" href="https://dbl.oisd.nl/basic">basic 过滤列表</a>，更多列表可在 <a target="_blank" rel="noopener" href="https://oisd.nl/downloads">https://oisd.nl/downloads</a> 中查看。</p><h2 id="DNS-请求处理流程"><a href="#DNS-请求处理流程" class="headerlink" title="DNS 请求处理流程"></a>DNS 请求处理流程</h2><ol><li>查询 hosts 文件匹配域名</li><li>查询缓存</li><li>屏蔽类型为 65 的 DNS 请求：返回 127.0.0.1（<a target="_blank" rel="noopener" href="https://www.v2ex.com/t/712074">为什么要屏蔽？</a>）</li><li>屏蔽广告域名：返回 NXDOMAIN</li><li>通过域名匹配网址，若匹配到则可第一次分流</li><li>从无污染服务器获取域名 IP，通过 IP 分流，此时可能出现以下情况<ul><li>获取到的 IP 是国外的 IP 则直接返回结果即可</li><li>获取的 IP 是国内 IP 或获取到国内有服务器的 CDN 厂商：将请求通过本地服务器再次解析并返回结果，此时又分为两种情况<ul><li>从国内服务器获取到了被污染的 IP 或使用国内服务器解析出的 IP 不是境内的 IP 则将请求再次交给国外无污染服务器处理</li><li>获取到的 IP 不满足上一条的则直接返回</li></ul></li></ul></li></ol><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>个人使用的配置文件如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######### 日志文件存放位置 #########</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="string">&quot;./mosdns.log&quot;</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">error</span></span><br><span class="line"><span class="comment">######### 数据源, 在这里声明规则文件 #########</span></span><br><span class="line"><span class="attr">data_providers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">geosite</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/geosite.dat</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">gfwip</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/gfw_ip_list.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">cdncn</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/cdn_domain_list.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">cn</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/cn.dat</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">force_cn</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/ecs_cn_domain.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">force_us</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/ecs_us_domain.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">hosts</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/hosts.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">oisd_dbl_basic</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./rule/oisd_dbl_basic.txt</span></span><br><span class="line">    <span class="attr">auto_reload:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">######### 插件 #########</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="comment"># 缓存</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">cache</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">cache</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">size:</span> <span class="number">102400</span></span><br><span class="line">      <span class="attr">lazy_cache_ttl:</span> <span class="number">86400</span></span><br><span class="line">      <span class="attr">cache_everything:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># hosts</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">hosts</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">hosts</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:hosts&quot;</span></span><br><span class="line">  <span class="comment"># 调整 ECS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">ecs_remote</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ecs</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">auto:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">ipv4:</span> <span class="string">&quot;代理服务器公网 IP&quot;</span></span><br><span class="line">      <span class="attr">mask4:</span> <span class="number">24</span></span><br><span class="line">      <span class="attr">force_overwrite:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">ecs_local</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ecs</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">auto:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">ipv4:</span> <span class="string">&quot;本地公网 IP&quot;</span></span><br><span class="line">      <span class="attr">mask4:</span> <span class="number">24</span></span><br><span class="line">      <span class="attr">force_overwrite:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 调整 TTL</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">ttl_long</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ttl</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">minimal_ttl:</span> <span class="number">300</span></span><br><span class="line">      <span class="attr">maximum_ttl:</span> <span class="number">3600</span></span><br><span class="line">  <span class="comment"># TYPE65 类型请求</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">qtype65</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">qtype:</span> [<span class="number">65</span>]</span><br><span class="line">  <span class="comment"># PTR 类型请求</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_ptr</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">qtype:</span> [<span class="number">12</span>]</span><br><span class="line">  <span class="comment"># 屏蔽请求</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">black_hole</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">blackhole</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">rcode:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">ipv4:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">      <span class="attr">ipv6:</span> <span class="string">&quot;::1&quot;</span></span><br><span class="line">  <span class="comment"># 转发请求给阿里 DNS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_ali</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">fast_forward</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">upstream:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;tls://223.5.5.5&quot;</span></span><br><span class="line">          <span class="attr">trusted:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_pipeline:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;tls://223.6.6.6&quot;</span></span><br><span class="line">          <span class="attr">trusted:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_pipeline:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 转发请求给 Google DNS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_google</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">fast_forward</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">upstream:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;tls://8.8.4.4&quot;</span></span><br><span class="line">          <span class="attr">trusted:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_pipeline:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;https://dns.google/dns-query&quot;</span></span><br><span class="line">          <span class="attr">dial_addr:</span> <span class="string">&quot;2001:4860:4860::8888&quot;</span></span><br><span class="line">          <span class="attr">trusted:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_pipeline:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_http3:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 转发请求给 iQDNS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_iqdns</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">fast_forward</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">upstream:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;https://cn-east.lele233.com/dns-query&quot;</span></span><br><span class="line">          <span class="attr">dial_addr:</span> <span class="string">&quot;112.132.212.159&quot;</span></span><br><span class="line">          <span class="attr">trusted:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enable_pipeline:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 转发请求给 EasyMos DNS</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_easymos</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">forward</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">upstream:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">addr:</span> <span class="string">&quot;https://doh.apad.pro/cn-query&quot;</span></span><br><span class="line">      <span class="attr">bootstrap:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;119.29.29.29&quot;</span></span><br><span class="line">  <span class="comment"># 并行转发至本地服务器</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_local</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">sequence</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">parallel:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="bullet">-</span> <span class="string">&quot;forward_ali&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="bullet">-</span> <span class="string">&quot;forward_iqdns&quot;</span></span><br><span class="line">  <span class="comment"># 并行转发至远程无污染服务器</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">forward_remote</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">sequence</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">parallel:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="bullet">-</span> <span class="string">&quot;forward_google&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="bullet">-</span> <span class="string">&quot;forward_easymos&quot;</span></span><br><span class="line">  <span class="comment"># 匹配 CDN 域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_cdn_cn_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:cdncn&quot;</span></span><br><span class="line">  <span class="comment"># 匹配 本地域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_local_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:geosite:cn,private,apple-cn,steam@cn,google-cn,category-games@cn&quot;</span></span><br><span class="line">  <span class="comment"># 匹配 地址非中国的域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_non_local_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:geosite:geolocation-!cn&quot;</span></span><br><span class="line">  <span class="comment"># 匹配 广告域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_ad_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:oisd_dbl_basic&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:geosite:category-ads-all&quot;</span></span><br><span class="line">  <span class="comment"># 强制本地解析: 可在 ./rule/ecs_cn_domain.txt 文件中添加域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_cn_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:force_cn&quot;</span></span><br><span class="line">  <span class="comment"># 强制非本地解析: 可在 ./rule/ecs_us_domain.txt 文件中添加域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">query_is_us_domain</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">query_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">domain:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:force_us&quot;</span></span><br><span class="line">  <span class="comment"># 结果有本地 IP</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">response_has_local_ip</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">response_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">ip:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:cn:cn&quot;</span></span><br><span class="line">  <span class="comment"># 匹配 Akamai 的 CDN 域名</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">response_cname_akamai</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">response_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">cname:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;akamaiedge.net&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;akadns.net&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;edgekey.net&quot;</span></span><br><span class="line">  <span class="comment"># 匹配被污染 IP</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">response_has_gfw_ip</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">response_matcher</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">ip:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;provider:gfwip&quot;</span></span><br><span class="line">  <span class="comment"># 主要运行逻辑</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">tag:</span> <span class="string">main_sequence</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">sequence</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hosts</span> <span class="comment"># 域名映射 IP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cache</span> <span class="comment"># 缓存</span></span><br><span class="line">        <span class="comment"># 屏蔽 TYPE65 类型请求并拦截广告</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&quot;qtype65&quot;</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">black_hole</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_return</span></span><br><span class="line">        <span class="comment"># 屏蔽广告域名</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">query_is_ad_domain</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_new_nxdomain_response</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_return</span></span><br><span class="line">        <span class="comment"># 本地解析: 强制本地解析、PTR 请求、本地域名、CDN 域名、akamai 节点</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&quot;(query_is_cn_domain) || [query_is_ptr] || (query_is_local_domain) || (query_is_cdn_cn_domain) || (response_cname_akamai)&quot;</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ecs_local</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">forward_local</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_return</span></span><br><span class="line">        <span class="comment"># 非本地解析: 强制非本地解析、位置非中国的域名</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&quot;(query_is_us_domain) || (query_is_non_local_domain)&quot;</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_prefer_ipv4</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ecs_remote</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">forward_remote</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ttl_long</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_return</span></span><br><span class="line">        <span class="comment"># 未知域名 IP 分流</span></span><br><span class="line">        <span class="comment"># 远程获取应答, 丢弃本地 IP 结果</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">primary:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">_prefer_ipv4</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ecs_remote</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">forward_remote</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&quot;(response_has_local_ip) || (response_cname_akamai)&quot;</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">_drop_response</span></span><br><span class="line">          <span class="comment"># 本地获取应答</span></span><br><span class="line">          <span class="attr">secondary:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ecs_local</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">forward_local</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">if:</span> <span class="string">&quot;(! response_has_local_ip) &amp;&amp; [_response_valid_answer] || (response_has_gfw_ip)&quot;</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">_prefer_ipv4</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ecs_remote</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">forward_remote</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ttl_long</span></span><br><span class="line">          <span class="comment"># 避免 DNS 泄漏</span></span><br><span class="line">          <span class="attr">fast_fallback:</span> <span class="number">2500</span></span><br><span class="line">          <span class="attr">always_standby:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">######### 监听地址 #########</span></span><br><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">exec:</span> <span class="string">main_sequence</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">listeners:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">udp</span></span><br><span class="line">        <span class="attr">addr:</span> <span class="string">&quot;127.0.0.1:53&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">udp</span></span><br><span class="line">        <span class="attr">addr:</span> <span class="string">&quot;[::1]:53&quot;</span></span><br></pre></td></tr></table></figure><h2 id="测试本地-DNS-运行情况"><a href="#测试本地-DNS-运行情况" class="headerlink" title="测试本地 DNS 运行情况"></a>测试本地 DNS 运行情况</h2><p>使用 <a target="_blank" rel="noopener" href="https://github.com/natesales/q">q</a> 作为测试工具，支持 UDP、TCP、DoT、DoH、DoQ 等协议，同时支持设置 ECS。</p><h3 id="国内网站解析测试"><a href="#国内网站解析测试" class="headerlink" title="国内网站解析测试"></a>国内网站解析测试</h3><p>选用浙江电信 202.101.172.35 作为 ECS 地址进行测试。</p><ol><li><p><a target="_blank" rel="noopener" href="https://www.iqiyi.com/">爱奇艺</a></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673953706420.png"></p><ul><li>仅用 32ms 返回结果，解析到了武汉机房</li></ul></li><li><p>bilibili 负载均衡域名：<code>i0.hdslb.com</code>、<code>i1.hdslb.com</code>、<code>s1.hdslb.com</code></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673953829048.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673953833412.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673953836246.png"></p><ul><li>可以看到均能正确解析，且解析时间均在 30ms 左右，非常快</li><li>IPv4 解析结果均在浙江邻省，可认为 ECS 正常发挥作用</li></ul></li><li><p><a target="_blank" rel="noopener" href="https://www.oschina.net/">开源中国</a><br><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673953912020.png"></p><ul><li>解析到了上海，且解析速度较快</li></ul></li></ol><h3 id="国外网站解析测试"><a href="#国外网站解析测试" class="headerlink" title="国外网站解析测试"></a>国外网站解析测试</h3><ol><li><p>Google 系网站，以 google.com 为例</p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951541023.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951613279.png"></p><ul><li>均在 180ms 以内得到正确的解析结果，且解析到了距离洛杉矶代理服务器最近的地点</li></ul></li><li><p><a target="_blank" rel="noopener" href="https://www.reddit.com/">维基百科</a></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951686762.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951689851.png"></p><ul><li>解析延迟在可接受的范围内</li></ul></li><li><p><a target="_blank" rel="noopener" href="https://github.com/">GitHub</a></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951957703.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951964166.png"></p><ul><li>200ms 以内得出正确的解析结果，ping 延迟可接受</li></ul></li><li><p>CloudFlare CDN：以 <a target="_blank" rel="noopener" href="https://www.v2ex.com/">v2ex 论坛</a> 为例</p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673951994369.png"></p><p><img data-src="/hexo-blog/2023/01/16/%E4%BD%BF%E7%94%A8-Mosdns-%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E6%97%A0%E6%B1%A1%E6%9F%93-DNS/1673952002358.png"></p><ul><li>解析用时可接受，由于 Anycast 技术，在各个地方延迟均非常低</li></ul></li></ol><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a target="_blank" rel="noopener" href="https://irine-sistiana.gitbook.io/mosdns-wiki/mosdns-v4/ru-he-pei-zhi-mosdns">mosdns 官方文档</a></li><li><a target="_blank" rel="noopener" href="https://jasper1024.com/jasper/20211223034622">Jasper 的博客</a></li><li><a target="_blank" rel="noopener" href="https://github.com/pmkol/easymosdns">EasymosDNS</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://schenga39.github.io/hexo-blog/2022/12/31/Obsidian-DataviewJS-%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo-blog/images/avatar.gif"><meta itemprop="name" content="SChenga"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="SChenga's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | SChenga's blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/hexo-blog/2022/12/31/Obsidian-DataviewJS-%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">Obsidian DataviewJS 插件使用实例</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">2023-01-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-24 18:10:18" itemprop="dateModified" datetime="2025-07-24T18:10:18+08:00">2025-07-24</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Obsidian 是一个功能强大的笔记应用程序，越来越多的用户选择使用它来记录自己的思想、保存自己的笔记。它支持最近很火的双链功能，能在任意页面之间建立连接，最终形成知识网络。也可以不使用它的双链功能，只将其作为我们的个人知识管理库。<br>作为一款开源软件，Obsidian 的社区非常活跃，用户自己同时作为开发者在不断开发新的插件来扩展 Obsidian 的功能。其中一个非常有用的插件是 Dataview，它可以让用户使用 Markdown 文件中的数据来创建自定义视图和列表等。使用 Dataview，我们可以轻松地汇总、分析和可视化笔记中的数据。</p><p>Dataview 的另一个优点是可以通过简单的标记语言来过滤数据，使得用户可以快速、准确地找到他们需要的信息。这些标记可以使用类似 SQL 的语言进行编写，甚至支持自定义 JavaScript 函数来进一步扩展功能。</p><p>如果你是一个需要从海量笔记中快速获取信息的人，那么 Dataview 将是非常值得尝试的插件。本文中，我们将重点介绍它的使用和功能，同时也会分享一些我自己的使用经验和技巧。</p><h2 id="Dataview-Query-Language"><a href="#Dataview-Query-Language" class="headerlink" title="Dataview Query Language"></a>Dataview Query Language</h2><p>虽然本文讨论的是 Dataview 中的 JavaScript，但是还是简要介绍一下 Dataview 中的 Query Language。</p><p>一个完整的 Dataview 查询包括以下要素</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>QUERY<span class="operator">-</span>TYPE<span class="operator">&gt;</span> <span class="operator">&lt;</span>fields<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="operator">&lt;</span>source<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>DATA<span class="operator">-</span>COMMAND<span class="operator">&gt;</span> <span class="operator">&lt;</span>expression<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span>DATA<span class="operator">-</span>COMMAND<span class="operator">&gt;</span> <span class="operator">&lt;</span>expression<span class="operator">&gt;</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><ul><li>QUERY-TYPE 可以为 LIST、TASK、CALENDAR、TABLE</li><li>fileds 是要查询的字段</li><li>source 是数据来源，类似于 SQL 要查询的表</li><li>DATA-COMMAND 是对数据的限制条件<br>Dataview 使用示例：例如要查询当前笔记（Markdown 文件）同级目录下的 Books 文件夹中的所有文件并按照创建时间降序排序，可编写 Dataview 查询如下：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LIST</span><br><span class="line"><span class="keyword">FROM</span> &quot;Books&quot;</span><br><span class="line">SORT file.ctime <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure><p>如果我们要在此基础上加一点限制条件，例如文件中含有 <code>#致用</code> 标签的文件，则可以使用如下查询语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LIST</span><br><span class="line"><span class="keyword">FROM</span> &quot;Books&quot;</span><br><span class="line">SORT file.ctime <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">contains</span>(tags, &quot;#致用&quot;)</span><br></pre></td></tr></table></figure><p>更多示例可参考官方文档中关于 <a target="_blank" rel="noopener" href="https://blacksmithgu.github.io/obsidian-dataview/queries/structure/">Query Language</a> 的介绍。</p><h2 id="DataviewJS"><a href="#DataviewJS" class="headerlink" title="DataviewJS"></a>DataviewJS</h2><p>尽管 Dataview Query Language 能满足绝大部分需求，在部分场景下，我们希望能自定义查询。下面我们从具体实例出发，使用 DataviewJS 完成不同自定义任务。</p><h3 id="为指定名称文件夹内的文件编制索引"><a href="#为指定名称文件夹内的文件编制索引" class="headerlink" title="为指定名称文件夹内的文件编制索引"></a>为指定名称文件夹内的文件编制索引</h3><p>如果我们想查询当前文件夹下与当前文件名相同的文件夹内的所有文件，假设我们的文件目录如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├─ 离散数学.md</span><br><span class="line">└─ 离散数学</span><br><span class="line">　　 ├─ 01 命题逻辑.md</span><br><span class="line">　　 ├─ 02 谓词逻辑.md</span><br><span class="line">　　 ├─ 03 集合与关系.md</span><br><span class="line">　　 ├─ 04 函数.md</span><br><span class="line">　　 ├─ 05 代数系统.md</span><br><span class="line">　　 └─ 06 图和树.md</span><br></pre></td></tr></table></figure><p>我们希望使用 <code>离散数学.md</code> 为文件夹内的文件的索引，并按照序号排序，则可编写 DataviewJS 如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前文件名</span></span><br><span class="line"><span class="keyword">const</span> fileName = dv.<span class="title function_">current</span>().<span class="property">file</span>.<span class="property">name</span>;</span><br><span class="line"><span class="comment">// 提取文件前缀编号: 例如 01、02、03...</span></span><br><span class="line"><span class="keyword">const</span> fileIndex = fileName.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 获取文件所在文件夹</span></span><br><span class="line"><span class="keyword">let</span> path = dv.<span class="title function_">current</span>().<span class="property">file</span>.<span class="property">folder</span>;</span><br><span class="line"><span class="comment">// 如果文件不在根目录则在目录后加上路径分隔符</span></span><br><span class="line"><span class="keyword">if</span> (path) path += <span class="string">&quot;/&quot;</span>;</span><br><span class="line"><span class="comment">// 如果文件有编号则子文件夹为编号命名, 否则与该文件相同</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">isNaN</span>(<span class="built_in">parseInt</span>(fileIndex))) path += fileIndex;</span><br><span class="line"><span class="keyword">else</span> path += fileName;</span><br><span class="line"><span class="comment">// 使用 list 将结果返回</span></span><br><span class="line">dv.<span class="title function_">list</span>(</span><br><span class="line">  dv</span><br><span class="line">    <span class="comment">// 根据官方文档, 路径两边的双引号应该保留</span></span><br><span class="line">    .<span class="title function_">pages</span>(<span class="string">`&quot;<span class="subst">$&#123;path&#125;</span>&quot;`</span>)</span><br><span class="line">    <span class="comment">// 只查询一级子目录下的文档</span></span><br><span class="line">    .<span class="title function_">where</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">file</span>.<span class="property">folder</span> === path)</span><br><span class="line">    <span class="comment">// 按照文件名升序排序</span></span><br><span class="line">    .<span class="title function_">sort</span>(<span class="function">(<span class="params">c</span>) =&gt;</span> c.<span class="property">file</span>.<span class="property">name</span>).<span class="property">file</span>.<span class="property">link</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>得到的结果与预期相符。</p><h3 id="为会议记录编制清单"><a href="#为会议记录编制清单" class="headerlink" title="为会议记录编制清单"></a>为会议记录编制清单</h3><p>为了实现编程读取文件名中的日期，我们需要将所有会议记录文件按照格式 <code>年月日_会议主题</code> 来命名，例如 <code>20220422_软件组会</code>，然后我们就可以在会议文件夹所在目录下建立与会议文件夹同名的文件，并编程如下，即可得到预期结果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├─ 会议.md</span><br><span class="line">└─ 会议</span><br><span class="line">　　 ├─ 20220114_社会调查.md</span><br><span class="line">　　 ├─ 20220514_常规组会.md</span><br><span class="line">　　 └─ 20220626_教育评议.md</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">dv.<span class="title function_">table</span>(</span><br><span class="line">  <span class="comment">// 表头为 Date、Category、Title 三个字段</span></span><br><span class="line">  [<span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Category&quot;</span>, <span class="string">&quot;Title&quot;</span>],</span><br><span class="line">  dv</span><br><span class="line">    <span class="comment">// 在与当前文件同名的文件夹中查找结果</span></span><br><span class="line">    .<span class="title function_">pages</span>(<span class="string">`&quot;<span class="subst">$&#123;dv.current().file.name&#125;</span>&quot;`</span>)</span><br><span class="line">    <span class="comment">// 结果按字母序顺序排序</span></span><br><span class="line">    .<span class="title function_">sort</span>(<span class="function">(<span class="params">page</span>) =&gt;</span> page.<span class="property">file</span>.<span class="property">name</span>)</span><br><span class="line">    <span class="comment">// 对 page 进行操作来最终获得表头的三个字段</span></span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> fileName = page.<span class="property">file</span>.<span class="property">name</span>;</span><br><span class="line">      <span class="comment">// 匹配开头的日期, 格式必须是 20220305</span></span><br><span class="line">      <span class="keyword">const</span> matchResult = fileName.<span class="title function_">match</span>(<span class="regexp">/(\d&#123;4&#125;)(\d&#123;2&#125;)(\d&#123;2&#125;)/</span>);</span><br><span class="line">      <span class="comment">// 自定义链接名, 使用 substring() 去掉文件名的日期部分</span></span><br><span class="line">      <span class="keyword">const</span> updatedFileLink = dv.<span class="title function_">fileLink</span>(</span><br><span class="line">        page.<span class="property">file</span>.<span class="property">path</span>,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        fileName.<span class="title function_">substring</span>(<span class="number">9</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        <span class="comment">// Date: 使用 - 分割年月日</span></span><br><span class="line">        <span class="string">`<span class="subst">$&#123;matchResult[<span class="number">1</span>]&#125;</span>-<span class="subst">$&#123;matchResult[<span class="number">2</span>]&#125;</span>-<span class="subst">$&#123;matchResult[<span class="number">3</span>]&#125;</span>`</span>,</span><br><span class="line">        <span class="comment">// Category: 每个文件中的 tag</span></span><br><span class="line">        page.<span class="property">file</span>.<span class="property">tags</span>,</span><br><span class="line">        <span class="comment">// Title: 自定义链接名作为标题</span></span><br><span class="line">        updatedFileLink,</span><br><span class="line">      ];</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="为-OJ-刷题记录编制索引"><a href="#为-OJ-刷题记录编制索引" class="headerlink" title="为 OJ 刷题记录编制索引"></a>为 OJ 刷题记录编制索引</h3><p>此例中，我们需要记录来自不同平台题目，需要根据 URL 提取平台信息，并显示当前文件的通过状态，例如 A 表示 Accept，N 表示 Not Started，W 表示 Wrong Answer。实现这样的功能需要在子目录的 markdown 头部添加 metadata 如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">URL:</span> <span class="string">https://leetcode.cn/problems/two-sum</span></span><br><span class="line"><span class="attr">Status:</span> <span class="string">A</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>然后我们就可以使用 <code>page.status</code> 和 <code>page.url</code> 访问到这两个变量，并根据需要进行映射，得到最终结果。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">dv.<span class="title function_">table</span>(</span><br><span class="line">  [<span class="string">&quot;Title&quot;</span>, <span class="string">&quot;Source&quot;</span>, <span class="string">&quot;Tags&quot;</span>, <span class="string">&quot;Status&quot;</span>],</span><br><span class="line">  dv</span><br><span class="line">    .<span class="title function_">pages</span>(<span class="string">`&quot;<span class="subst">$&#123;dv.current().file.folder&#125;</span>/<span class="subst">$&#123;dv.current().file.name&#125;</span>&quot;`</span>)</span><br><span class="line">    .<span class="title function_">sort</span>(<span class="function">(<span class="params">b</span>) =&gt;</span> [b.<span class="property">status</span>, b.<span class="property">tags</span>, b.<span class="property">title</span>])</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">b</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> result, source;</span><br><span class="line">      <span class="comment">// 用于映射 URL 中的关键字和 table 的 Source 字段</span></span><br><span class="line">      <span class="keyword">const</span> sourceMap = &#123;</span><br><span class="line">        <span class="attr">leetcode</span>: <span class="string">&quot;LeetCode&quot;</span>,</span><br><span class="line">        <span class="attr">pintia</span>: <span class="string">&quot;PinTiA&quot;</span>,</span><br><span class="line">        <span class="attr">atcoder</span>: <span class="string">&quot;AtCoder&quot;</span>,</span><br><span class="line">        <span class="attr">luogu</span>: <span class="string">&quot;洛谷&quot;</span>,</span><br><span class="line">        <span class="attr">codeforce</span>: <span class="string">&quot;Codeforces&quot;</span>,</span><br><span class="line">        <span class="attr">nowcoder</span>: <span class="string">&quot;牛客&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 用于将文件中的 A、N、W 映射为不同颜色的状态显示在表格中</span></span><br><span class="line">      <span class="keyword">const</span> statusMap = &#123;</span><br><span class="line">        <span class="attr">A</span>: <span class="string">&quot;&lt;b&gt;&lt;font color=green&gt;Accept&lt;/font&gt;&lt;/b&gt;&quot;</span>,</span><br><span class="line">        <span class="attr">N</span>: <span class="string">&quot;&lt;b&gt;&lt;font color=grey&gt;Not Started&lt;/font&gt;&lt;/b&gt;&quot;</span>,</span><br><span class="line">        <span class="attr">W</span>: <span class="string">&quot;&lt;b&gt;&lt;font color=red&gt;Wrong Answer&lt;/font&gt;&lt;/b&gt;&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (b.<span class="property">url</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> sourceMap) &#123;</span><br><span class="line">          <span class="keyword">if</span> (~b.<span class="property">url</span>.<span class="title function_">indexOf</span>(k)) &#123;</span><br><span class="line">            source = sourceMap[k];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> source = <span class="string">&quot;其他&quot;</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">in</span> statusMap) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k === b.<span class="property">status</span>) &#123;</span><br><span class="line">          result = statusMap[k];</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 和表头的四个字段一一对应</span></span><br><span class="line">      <span class="keyword">return</span> [b.<span class="property">file</span>.<span class="property">link</span>, source, b.<span class="property">file</span>.<span class="property">tags</span>, result];</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>得到的结果如下：</p><p><img data-src="/hexo-blog/2022/12/31/Obsidian-DataviewJS-%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/1678841002699.png"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a target="_blank" rel="noopener" href="https://blacksmithgu.github.io/obsidian-dataview/">DataviewJS 文档</a></li></ol></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/hexo-blog/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/hexo-blog/page/2/"><i class="fa fa-angle-right"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">SChenga</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript></body></html>